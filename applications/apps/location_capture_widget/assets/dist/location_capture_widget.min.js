!function($){"use strict";function inited(welem){var widget_data=welem.data(WIDGET_NS);return"undefined"!=typeof widget_data}var WIDGET_NAME="ANDS Location Capture Widget",WIDGET_NS="location_widget",DEFAULT_PROTOCOL="https://",DEFAULT_SERVICE_POINT=DEFAULT_PROTOCOL+"services.ands.org.au/api/resolver",ENABLE_GAZETTEER=!1,POLY_COLOUR="#008dce",OPEN_POLY_COLOUR="#ff0000",TOOL_POINT_PREFIX="alw_tool_point",TOOL_REGION_PREFIX="alw_tool_region",TOOL_BOX_PREFIX="alw_tool_box",TOOL_TEXT_PREFIX="alw_tool_text",TOOL_SEARCH_PREFIX="alw_tool_search",EMPTY_MAP_PREFIX="alw_clear",RESET_MAP_PREFIX="alw_reset",CANVAS_ID_PREFIX="alw_canvas_",ADDRESS_SEARCH_DIALOG_ID_PREFIX="alw_search_",ADDRESS_SEARCH_TEXTFIELD_ID_PREFIX="alw_search_textfield",ADDRESS_SEARCH_RESULTS_ID_PREFIX="alw_search_results",LONLAT_DIALOG_ID_PREFIX="alw_lonlat_",LONLAT_TEXTAREA_ID_PREFIX="alw_lonlat_textarea",INLINE_MESSAGE_ID_PREFIX="alw_msg_",PLUGIN_DEFAULTS={target:"geoLocation",lonLat:!1,endpoint:DEFAULT_SERVICE_POINT,gasset_protocol:DEFAULT_PROTOCOL,zoom:3,start:"133, -27",jumpToPoint:!0,mode:!1},methods={googlemap:function(){$(this);alert(WIDGET_NAME+" not initialised!")},init:function(options){if(inited($(this)))return $(this);var settings=$.extend({},PLUGIN_DEFAULTS,options);return this.each(function(){function makeMapWidget(){loadFeatureTypes()}function getErrorMessage(){var widget_data=$this.data(WIDGET_NS);return widget_data.error_message}function setErrorMessage(message){var widget_data=$this.data(WIDGET_NS);widget_data.error_message=message,$this.data(WIDGET_NS,widget_data)}function loadFeatureTypes(){$.each(["feature"],function(idx,type){var source=settings.endpoint+"?feature="+type+"&callback=?";$.getJSON(source,function(data){"OK"==data.status&&(ENABLE_GAZETTEER=!0,addFeatureTypes(data),getMapControl())})})}function addFeatureTypes(data){for(var widget_data=$this.data(WIDGET_NS),i=0;i<data.items.length;i++){var title=data.items[i].title,id=data.items[i].id;widget_data.feature_types[id]=title}$this.data(WIDGET_NS,widget_data)}function setOriginalInputFieldValue(value){var widget_data=$this.data(WIDGET_NS);widget_data.input_field_orig=value,$this.data(WIDGET_NS,widget_data)}function getOriginalInputFieldValue(){return $this.data(WIDGET_NS).input_field_orig}function getMapControl(){var map=null,widget_data=$this.data(WIDGET_NS);try{setOriginalInputFieldValue($target.val());var mapCanvasId=CANVAS_ID_PREFIX+$this.attr("id");getToolBarHTML($this),getAddressSearchDialogHTML($this),getLonLatDialogHTML($this),$this.append('<div class="alw_canvas" id="'+mapCanvasId+'"/>'),widget_data.pushpin_edit||(widget_data.pushpin_edit=new google.maps.MarkerImage(settings.gasset_protocol+"maps.google.com/intl/en_us/mapfiles/ms/micons/orange.png",new google.maps.Size(32,32),new google.maps.Point(0,0),new google.maps.Point(16,32))),widget_data.pushpin||(widget_data.pushpin=new google.maps.MarkerImage(settings.gasset_protocol+"maps.google.com/intl/en_us/mapfiles/ms/micons/blue.png",new google.maps.Size(32,32),new google.maps.Point(0,0),new google.maps.Point(16,32))),widget_data.shadow=new google.maps.MarkerImage(settings.gasset_protocol+"maps.google.com/intl/en_us/mapfiles/ms/micons/msmarker.shadow.png",new google.maps.Size(36,32),new google.maps.Point(0,0),new google.maps.Point(16,32));var mapCanvas=$("#"+mapCanvasId),myOptions={zoom:settings.zoom,disableDefaultUI:!0,center:settings.start,panControl:!0,zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!1,overviewMapControl:!0,mapTypeId:google.maps.MapTypeId.TERRAIN};map=new google.maps.Map(mapCanvas[0],myOptions);{new google.maps.LatLngBounds,google.maps.event.addListenerOnce(map,"idle",function(){setMapFromInputField(!0)})}if(map.setOptions({draggableCursor:"default"}),map.setOptions({draggingCursor:"move"}),widget_data.map=map,widget_data.geocoder=new google.maps.Geocoder,$this.data(WIDGET_NS,widget_data),settings.mode!==!1)switch(settings.mode){case"search":showAddressSearchDialog($("#"+TOOL_SEARCH_PREFIX+$this.attr("id")));break;case"coords":showLonLatDialog($("#"+TOOL_TEXT_PREFIX+$this.attr("id")))}}catch(e){showError("The mapping tool has failed to load. Your browser must allow non-HTTPS content to load on this page in order to use this tool.<br/><br/>(JSException: "+e+")")}}function showError(message,container){"undefined"==typeof container&&(container=$this),"undefined"==typeof message&&(message=getErrorMessage()),container.addClass("alw_loaderror"),container.html(message),container.is(":hidden")&&($('<a style="float:right" id = "'+container.attr("id")+'-close" href="#">[X]</a><br/>').prependTo(container),$(document).on("click","#"+container.attr("id")+"-close",function(event){return event.preventDefault(),$(this).parent().hide(),!1}),container.show())}function getToolBarHTML(welem){var id=null,html='<div class="alw_toolbar">',widget_data=$this.data(WIDGET_NS);id=TOOL_POINT_PREFIX+$this.attr("id"),widget_data.tools[id]=!1,$this.on("click","#"+id,null,function(){startPoint("#"+TOOL_POINT_PREFIX+$this.attr("id"))}),html+='<span class="alw_tool" id="'+id+'" title="Mark a point on the map">point</span>',id=TOOL_REGION_PREFIX+$this.attr("id"),$this.on("click","#"+id,null,function(){startRegion($("#"+TOOL_REGION_PREFIX+$this.attr("id")))}),widget_data.tools[id]=!1,html+='<span class="alw_tool" id="'+id+'" title="Draw a polygon on the map to mark a region">region</span>',id=TOOL_BOX_PREFIX+$this.attr("id"),$this.on("click","#"+id,null,function(){beginDrawingBox()}),widget_data.tools[id]=!1,html+='<span class="alw_tool" id="'+id+'" title="Draw a polygon on the map to mark a region">box</span>',id=TOOL_SEARCH_PREFIX+$this.attr("id"),widget_data.tools[id]=!1,$this.on("click","#"+id,null,function(){showAddressSearchDialog($("#"+TOOL_SEARCH_PREFIX+$this.attr("id")))}),html+='<span class="alw_tool" id="'+id+'" title="Search for a place or region to mark on the map">search...</span>',id=TOOL_TEXT_PREFIX+$this.attr("id"),$this.on("click","#"+id,null,function(){showLonLatDialog($("#"+TOOL_TEXT_PREFIX+$this.attr("id")))}),widget_data.tools[id]=!1,html+='<span class="alw_tool" id="'+id+'" title="Enter longitude,latitude pairs to mark a point or a region on the map">coordinates...</span>',id=EMPTY_MAP_PREFIX+$this.attr("id"),$this.on("click","#"+id,null,function(){emptyMap()}),html+='<span class="alw_special_tool cleartool" id="'+id+'" title="Clear the marker/region data">clear</span>',null!==widget_data.input_field_orig&&""!==widget_data.input_field_orig&&(id=RESET_MAP_PREFIX+$this.attr("id"),$this.on("click","#"+id,null,function(){resetMap()}),html+='<span class="alw_special_tool" id="'+id+'" title="Reset the map to its initial state">reset</span>'),html+="</div>",$this.data(WIDGET_NS,widget_data),welem.append(html)}function setToolActive(tool,active){tool=$(tool);var widget_data=$this.data(WIDGET_NS);widget_data.tools[tool.attr("id")]=active,active?tool.addClass("alw_tool_active").removeClass("alw_tool"):tool.removeClass("alw_tool_active").addClass("alw_tool"),$this.data(WIDGET_NS,widget_data)}function getToolActive(tool){tool=$(tool);var widget_data=$this.data(WIDGET_NS);return widget_data.tools[tool.attr("id")]}function resetTools(centre){centre="undefined"==typeof centre?!0:!1;var widget_data=$this.data(WIDGET_NS);$.each([TOOL_POINT_PREFIX,TOOL_REGION_PREFIX,TOOL_BOX_PREFIX,TOOL_TEXT_PREFIX,LONLAT_DIALOG_ID_PREFIX,LONLAT_TEXTAREA_ID_PREFIX,TOOL_SEARCH_PREFIX,ADDRESS_SEARCH_DIALOG_ID_PREFIX],function(idx,prefix){var object=$("#"+prefix+$this.attr("id"));switch(setToolActive(object,!1),prefix){case LONLAT_DIALOG_ID_PREFIX:case ADDRESS_SEARCH_DIALOG_ID_PREFIX:object.hide();break;case LONLAT_TEXTAREA_ID_PREFIX:object.val("")}}),widget_data.map.setOptions({draggableCursor:"default"}),widget_data.map.setOptions({draggingCursor:"move"}),$.each(widget_data.marker_listeners,function(idx,listener){google.maps.event.removeListener(listener)}),null!==widget_data.drawing_manager&&widget_data.drawing_manager.setMap(null),setMapFromData($target.val(),{centre:centre,reset:!1}),$this.data(WIDGET_NS,widget_data)}function resetMap(){setMapFromData(getOriginalInputFieldValue(),{centre:!0})}function resetZoomLevel(){var widget_data=$this.data(WIDGET_NS);google.maps.event.trigger(widget_data.map,"resize")}function emptyMap(){setMapFromData("",{centre:!0})}function tidyLonLatText(lonlatText){var cleanLonLatText=lonlatText;return""!==cleanLonLatText&&(cleanLonLatText=cleanLonLatText.replace(new RegExp("\\s*,\\s*","g"),","),cleanLonLatText=cleanLonLatText.replace(new RegExp("\\s+","g")," "),cleanLonLatText=$.trim(cleanLonLatText)),cleanLonLatText}function getCoordsFromString(cstr){var coords=new Array,lonlatText=tidyLonLatText(cstr);if(""!==lonlatText&&validateLonLatText(lonlatText))for(var coordsStr=lonlatText.split(" "),i=0;i<coordsStr.length;i++){var coordsPair=coordsStr[i].split(",");coords[i]=new google.maps.LatLng(coordsPair[1],coordsPair[0])}return coords}function validateLonLatText(lonlatText){var valid=!0;if(""!==lonlatText){var coords=lonlatText.split(" "),lat=null,lon=null,coordsPair=null;2===coords.length&&(setErrorMessage("The coordinates don't represent a point or a region."),valid=!1);for(var i=0;i<coords.length&&valid;i++){if(coordsPair=coords[i].split(","),lat=coordsPair[1],lon=coordsPair[0],isNaN(lat)||isNaN(lon)){setErrorMessage("Some coordinates are not numbers."),valid=!1;break}if(Math.abs(lat)>90||Math.abs(lon)>180){setErrorMessage("Some coordinates have invalid values."),valid=!1;break}i===coords.length-1&&coords[0]!==coords[i]&&(setErrorMessage("The coordinates don't represent a point or a region. To define a region the last point needs to be the same as the first."),valid=!1)}}return valid}function clearMap(){removeMarker(),removePolygon();var widget_data=$this.data(WIDGET_NS);null!==widget_data.drawing_manager&&(widget_data.drawing_manager.setMap(null),$this.data(WIDGET_NS,widget_data)),resetZoomLevel()}function centreMap(){var widget_data=$this.data(WIDGET_NS);if(null!==widget_data.polygon){var i,bounds=new google.maps.LatLngBounds,polygonCoords=widget_data.polygon.getPath().getArray();for(i=0;i<polygonCoords.length;i++)bounds.extend(polygonCoords[i]);widget_data.map.fitBounds(bounds)}null!==widget_data.marker&&settings.jumpToPoint&&widget_data.map.setCenter(widget_data.marker.getPosition()),$this.data(WIDGET_NS,widget_data)}function startPoint(tool){tool=$(tool);var widget_data=$this.data(WIDGET_NS),active=getToolActive(tool);if(resetTools(settings.jumpToPoint),widget_data.map.setOptions({draggableCursor:"crosshair"}),!active){setToolActive(tool,!0);var coords=getCoordsFromString($target.val());1===coords.length&&createMarker(coords[0],!0),widget_data.marker_listeners.push(google.maps.event.addListener(widget_data.map,"click",function(e){e.latLng&&($target.val(e.latLng.lng().toFixed(6)+","+e.latLng.lat().toFixed(6)),resetTools(settings.jumpToPoint))})),settings.jumpToPoint&&centreMap()}}function createMarker(latlng,editable){var widget_data=$this.data(WIDGET_NS);clearMap();var marker=null;editable?(marker=new google.maps.Marker({position:latlng,map:widget_data.map,icon:widget_data.pushpin_edit,shadow:widget_data.shadow,draggable:!0}),google.maps.event.addListener(marker,"dragend",function(){var latlng=marker.getPosition();$target.val(latlng.lng().toFixed(6)+","+latlng.lat().toFixed(6))})):marker=new google.maps.Marker({position:latlng,map:widget_data.map,icon:widget_data.pushpin,shadow:widget_data.shadow,clickable:!1}),widget_data.marker=marker,$this.data(WIDGET_NS,widget_data),$target.val(latlng.lng().toFixed(6)+","+latlng.lat().toFixed(6))}function removeMarker(){var widget_data=$this.data(WIDGET_NS);null!==widget_data.marker&&(widget_data.marker.setMap(null),widget_data.marker=null),$this.data(WIDGET_NS,widget_data)}function startRegion(tool){tool=$(tool);var widget_data=$this.data(WIDGET_NS),active=getToolActive(tool);if(resetTools(),!active){setToolActive(tool,!0);var coords=getCoordsFromString($target.val());coords.length>2?(createPolygon(coords,!0),centreMap()):beginDrawing("")}$this.data(WIDGET_NS,widget_data)}function beginDrawing(latLng){var widget_data=$this.data(WIDGET_NS);$.each(widget_data.marker_listeners,function(idx,listener){google.maps.event.removeListener(listener)}),widget_data.drawing_manager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!1,polygonOptions:{fillColor:OPEN_POLY_COLOUR,paths:[latLng],fillOpacity:.2,strokeColor:OPEN_POLY_COLOUR,strokeWeight:2,clickable:!0,zIndex:1,editable:!0}}),widget_data.drawing_manager.setMap(widget_data.map),$this.data(WIDGET_NS,widget_data),google.maps.event.addListener(widget_data.drawing_manager,"polygoncomplete",function(polygon){var widget_data=$this.data(WIDGET_NS);savePolygonString(polygon.getPath()),polygon.setMap(null),widget_data.drawing_manager.setMap(null),resetTools()})}function beginDrawingBox(){var widget_data=$this.data(WIDGET_NS);$.each(widget_data.marker_listeners,function(idx,listener){google.maps.event.removeListener(listener)}),widget_data.drawing_manager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.RECTANGLE,drawingControl:!1,polygonOptions:{fillColor:OPEN_POLY_COLOUR,fillOpacity:.2,strokeColor:OPEN_POLY_COLOUR,strokeWeight:2,clickable:!0,zIndex:1,editable:!0}}),widget_data.drawing_manager.setMap(widget_data.map),$this.data(WIDGET_NS,widget_data),google.maps.event.addListener(widget_data.drawing_manager,"overlaycomplete",function(e){var geoCodeRectangle=e.overlay;widget_data.box=geoCodeRectangle;var bnds=geoCodeRectangle.getBounds(),n=bnds.getNorthEast().lat().toFixed(6),e=bnds.getNorthEast().lng().toFixed(6),s=bnds.getSouthWest().lat().toFixed(6),w=bnds.getSouthWest().lng().toFixed(6),polyString=w+","+n+" "+e+","+n+" "+e+","+s+" "+w+","+s+" "+w+","+n;clearMap(),$target.val(polyString);var coords=getCoordsFromString(polyString),polygon=new google.maps.Polygon({paths:coords,map:widget_data.map,strokeColor:POLY_COLOUR,strokeOpacity:.7,strokeWeight:2,fillColor:POLY_COLOUR,fillOpacity:.2,editable:!1});widget_data.polygon=polygon,$this.data(WIDGET_NS,widget_data)})}function createPolygon(coords,editable){var widget_data=$this.data(WIDGET_NS);clearMap();var polygon=null;editable?(polygon=new google.maps.Polygon({paths:coords,map:widget_data.map,strokeColor:OPEN_POLY_COLOUR,strokeOpacity:.7,strokeWeight:2,fillColor:OPEN_POLY_COLOUR,fillOpacity:.2,editable:!0,clickable:!0}),google.maps.event.addListener(polygon,"click",function(){savePolygonString(polygon.getPath())}),google.maps.event.addListener(polygon,"mouseup",function(){savePolygonString(polygon.getPath())}),google.maps.event.addListener(polygon,"mouseout",function(){savePolygonString(polygon.getPath())})):polygon=new google.maps.Polygon({paths:coords,map:widget_data.map,strokeColor:POLY_COLOUR,strokeOpacity:.7,strokeWeight:2,fillColor:POLY_COLOUR,fillOpacity:.2,editable:!1}),widget_data.polygon=polygon,$this.data(WIDGET_NS,widget_data)}function savePolygonString(path){for(var coords=path.getArray(),polyString="",i=0;i<coords.length;i++){var pLat=coords[i].lat(),pLng=coords[i].lng();polyString=0===i?pLng.toFixed(6)+","+pLat.toFixed(6):polyString+" "+pLng.toFixed(6)+","+pLat.toFixed(6)}polyString=polyString+" "+coords[0].lng().toFixed(6)+","+coords[0].lat().toFixed(6),$target.val(polyString),settings.return_callback&&"function"==typeof settings.return_callback&&settings.return_callback(polyString)}function removePolygon(){var widget_data=$this.data(WIDGET_NS);null!==widget_data.polygon&&(widget_data.polygon.setMap(null),widget_data.polygon=null),void 0!==widget_data.box&&null!==widget_data.box&&(widget_data.box.setMap(null),widget_data.box=null),$this.data(WIDGET_NS,widget_data)}function checkSearchEvent(event){var result=!0;return 13===event.which&&(result=!1,doSearch()),result}function showAddressSearchDialog(tool){tool=$(tool);var active=($this.data(WIDGET_NS),getToolActive(tool));if(resetTools(),!active){setToolActive(tool,!0),$("#"+ADDRESS_SEARCH_DIALOG_ID_PREFIX+$this.attr("id")).show();var searchResultsTextfield=$("#"+ADDRESS_SEARCH_TEXTFIELD_ID_PREFIX+$this.attr("id"));searchResultsTextfield.focus(),searchResultsTextfield.select()}}function doSearch(){var widget_data=$this.data(WIDGET_NS),searchResultsTextfield=$("#"+ADDRESS_SEARCH_TEXTFIELD_ID_PREFIX+$this.attr("id")),searchText=$.trim(searchResultsTextfield.val()),searchResultsDiv=$("#"+ADDRESS_SEARCH_RESULTS_ID_PREFIX+$this.attr("id"));""!==searchText?(searchResultsDiv.html("Searching..."),"geocoderSelector.gazetteer"===$("input[name=geocoderSelector]:checked").val()?gazetteerGeocoder(searchText):widget_data.geocoder.geocode({address:searchText},function(results,status){addAddressToMap(results,status)})):searchResultsDiv.html("Nothing to search on! Try entering some terms in the text box above")}function addAddressToMap(results,status){var markerBullet="",resultText="",coordString="";if(status!==google.maps.GeocoderStatus.OK)resultText="No locations found";else for(var i=0;i<results.length;i++){{results[i].geometry.location_type}if(results[i].geometry.bounds){var nE=results[i].geometry.bounds.getNorthEast(),sW=results[i].geometry.bounds.getSouthWest();coordString=nE.lng().toFixed(6)+","+nE.lat().toFixed(6)+" ",coordString+=sW.lng().toFixed(6)+","+nE.lat().toFixed(6)+" ",coordString+=sW.lng().toFixed(6)+","+sW.lat().toFixed(6)+" ",coordString+=nE.lng().toFixed(6)+","+sW.lat().toFixed(6)+" ",coordString+=nE.lng().toFixed(6)+","+nE.lat().toFixed(6),markerBullet="&#9633;"}else coordString=results[i].geometry.location.lng().toFixed(6)+","+results[i].geometry.location.lat().toFixed(6),markerBullet="&#8226;";resultText+='<div class="alw_search_result" data-coord="'+coordString+'" title="Set the map with this search result">'+markerBullet+"&nbsp;"+results[i].formatted_address+"</div>"}var searchResultsDiv=$("#"+ADDRESS_SEARCH_RESULTS_ID_PREFIX+$this.attr("id"));searchResultsDiv.html(resultText)}function gazetteerGeocoder(searchText){var requestUrl=settings.endpoint+"?searchText=*"+encodeURIComponent(searchText)+"*&limit=14&callback=?";$.getJSON(requestUrl,function(data){displayGazetteerData(data)})}function displayGazetteerData(data){var widget_data=$this.data(WIDGET_NS),markerBullet="&#8226;",resultText="",coordString="";if("0"===data.items_count)resultText="No locations found";else for(var i=0;i<data.items.length;i++){{data.items[i].coords}coordString=data.items[i].lat+","+data.items[i].lng;for(var typetext="",j=0;j<data.items[i].types.length;j++)0!==j&&(typetext+=", "),typetext+=widget_data.feature_types[data.items[i].types[j]]?widget_data.feature_types[data.items[i].types[j]]:data.items[i].types[j];resultText+='<div class="alw_search_result" data-coord="'+coordString+'" title="Set the map with this search result">'+markerBullet+"&nbsp;"+data.items[i].title+" ("+typetext+")</div>"}var searchResultsDiv=$("#"+ADDRESS_SEARCH_RESULTS_ID_PREFIX+$this.attr("id"));searchResultsDiv.html(resultText)}function makeDialog(append_to,dialog_id,content_for,toolbar_for){"function"!=typeof toolbar_for&&(toolbar_for=function(){return""}),"function"!=typeof content_for&&(content_for=function(){return""});var dialog_shell=$('<div class="alw_dialog_container">');dialog_shell.attr("id",dialog_id),dialog_shell.append('<img class="alw_dialog_back src="'+settings.gasset_protocol+'maps.google.com/mapfiles/iws_s.png" alt="" />'),dialog_shell.append('<div class="alw_dialog_outer"><div class="alw_dialog_inner"><div class="alw_dialog_content">'),dialog_shell.find("div.alw_dialog_content").html(content_for.call()),dialog_shell.find("div.alw_dialog_inner").append('<div class="alw_buttonbar"><button type="button" class="alw_button cancel">cancel</button>'+toolbar_for.call()+"</div>"),append_to.append(dialog_shell)}function getAddressSearchDialogHTML(welem){var mapDialogId=ADDRESS_SEARCH_DIALOG_ID_PREFIX+$this.attr("id"),searchResultsDivId=ADDRESS_SEARCH_RESULTS_ID_PREFIX+$this.attr("id"),searchResultsTextfieldId=ADDRESS_SEARCH_TEXTFIELD_ID_PREFIX+$this.attr("id");makeDialog(welem,mapDialogId,function(){return $(this).css("overflow","hidden"),ENABLE_GAZETTEER?'<div class="alw_dialog_text"><i>Search for a region or place to mark on the map</i></div><label style="cursor:hand"><input type="radio" id="geocoderSelector.gazetteer" name="geocoderSelector" checked="checked" value="geocoderSelector.gazetteer" /> Australian Gazetteer</label><label style="cursor:hand"><input type="radio" id="geocoderSelector.google" name="geocoderSelector" value="geocoderSelector.google" /> Google</label><div class="alw_dialog_text"><input type="text" id="'+searchResultsTextfieldId+'" style="margin: 0px; width: 210px;" />&nbsp;<button type="button" class="alw_button search">search</button></div><div id="'+searchResultsDivId+'" style="padding: 0px 0px 0px 8px; margin: 0px 0px 0px 0px; height: 138px; overflow:auto;"></div></div>':'<div class="alw_dialog_text"><i>Search for a region or place to mark on the map</i></div><div class="alw_dialog_text"><input type="text" id="'+searchResultsTextfieldId+'" style="margin: 0px; width: 210px;" />&nbsp;<button type="button" class="alw_button search">search</button></div><div id="'+searchResultsDivId+'" style="padding: 0px 0px 0px 8px; margin: 0px 0px 0px 0px; height: 138px; overflow:auto;"></div></div>'}),$this.on("click","#"+mapDialogId+" div.alw_dialog_text button.alw_button.search",null,function(){doSearch()}),$this.on("click","#"+mapDialogId+" div.alw_buttonbar button.alw_button.cancel",null,function(){resetTools()}),$this.on("click","#"+ADDRESS_SEARCH_RESULTS_ID_PREFIX+$this.attr("id")+" div.alw_search_result",null,function(){setMapFromData($(this).data("coord"),{centre:!0})}),$this.on("keypress","#"+searchResultsTextfieldId,null,function(event){return checkSearchEvent(event)})}function getLonLatDialogHTML(welem){var mapDialogId=LONLAT_DIALOG_ID_PREFIX+$this.attr("id");makeDialog(welem,mapDialogId,function(){var content=$('<div class="alw_dialog_text"><i>Enter space delimited longitude,latitude pairs</i></div>'),textarea=$('<textarea style="display: block; margin: auto; width: 278px; height: 174px;"></textarea>');return textarea.attr("id",LONLAT_TEXTAREA_ID_PREFIX+$this.attr("id")),content.append(textarea),content},function(){return'&nbsp;<button type="button" class="alw_button set" title="Set the map to show this point or region">set</button>'}),$this.on("click","#"+mapDialogId+" button.alw_button.cancel",null,function(){resetTools()}),$this.on("click","#"+mapDialogId+" button.alw_button.set",null,function(){setMapFromText()})}function showLonLatDialog(tool){tool=$(tool);var active=getToolActive(tool);if(resetTools(),!active){setToolActive(tool,!0);var lonlatTextarea=$("#"+LONLAT_TEXTAREA_ID_PREFIX+$this.attr("id"));lonlatTextarea.val($target.val());var dialog=$("#"+LONLAT_DIALOG_ID_PREFIX+$this.attr("id"));dialog.show(),lonlatTextarea.focus()}}function setMapFromData(data,options){var defaults={validate:!1,centre:!1,reset:!0};options=$.extend({},defaults,options),options.validate&&validateLonLatText(data)||!options.validate?($target.val(data),options.reset&&resetTools(),setMapFromInputField(options.centre)):showError("Problem setting map with supplied data:<br/>"+getErrorMessage()+"<br/>Cancel or correct the error and set.",$msgBox)}function setMapFromInputField(centred){clearMap();var coords=getCoordsFromString($target.val());1===coords.length?createMarker(coords[0],!1):coords.length>2&&createPolygon(coords,!1),centred&&centreMap()}function setMapFromText(){setMapFromData(tidyLonLatText($("#"+LONLAT_TEXTAREA_ID_PREFIX+$this.attr("id")).val()),{validate:!0,centre:!0})}var $this=$(this),$target=$("#"+settings.target);$('<div id="'+INLINE_MESSAGE_ID_PREFIX+$this.attr("id")+'"/>').insertBefore($this);var $msgBox=$("#"+INLINE_MESSAGE_ID_PREFIX+$this.attr("id"));if($msgBox.hide(),$this.addClass("alw_control"),$this.removeClass("alw_loaderror"),"undefined"==typeof $this.attr("id")){var wcount=$(".ands_location_map_container").length;wcount>0?(wcount+=1,$this.attr("id","ands_location_map_container-"+wcount)):$this.attr("id","ands_location_map_container"),$this.addClass("ands_location_map_container")}if($target.length){if("undefined"!=typeof $target.data("alwtarget"))return void showError("The specified target field `"+escape(settings.target)+"` is being used as a target for another map (id: `"+$target.data("alwtarget")+"`). Review plugin configuration and try again.",$this)}else $target=$('<input id="'+settings.target+'" name="'+settings.target+'" data-alwtarget="'+$this.attr("id")+'" type="hidden" />'),$target.insertAfter($this);settings.lonLat!==!1&&$target.val(settings.lonLat),$this.data(WIDGET_NS,{input_field_orig:null,pushpin:null,pushpin_edit:null,shadow:null,polygon:null,geocoder:null,error_message:null,map:null,marker:null,drawing_manager:null,tools:{},feature_types:{},marker_listeners:[]});try{if(settings.start=getCoordsFromString(settings.start)[0],!(settings.start instanceof google.maps.LatLng))return showError("Invalid start point: specify 'start' option as '<i>longitude</i>, <i>latitude</i>'"),$this}catch(e){return showError("Invalid start point"),$this}return settings.mode!==!1&&"search"!==settings.mode&&"coords"!==settings.mode?(showError("Invalid mode: currently, only <i>search</i> and <i>coords</i> are valid modes"),$this):void function(){makeMapWidget()}()})}};$.fn.ands_location_widget=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist for the "+WIDGET_NAME):methods.init.apply(this,arguments)}}(jQuery);