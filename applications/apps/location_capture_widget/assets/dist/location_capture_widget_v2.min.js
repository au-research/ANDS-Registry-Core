!function($){"use strict";var WIDGET_NS="location_widget",ENABLE_GAZETTEER=!1,PLUGIN_DEFAULTS={target:"geoLocation",lonLat:!1,endpoint:"https://researchdata.edu.au/api/location.jsonp/",gasset_protocol:"https://",zoom:3,start:"133, -27",jumpToPoint:!0,mode:!1};function inited(welem){return void 0!==welem.data(WIDGET_NS)}var methods={googlemap:function(){var $this=$(this);inited($this),alert("ANDS Location Capture Widget not initialised!")},init:function(options){if(inited($(this)))return $(this);var settings=$.extend({},PLUGIN_DEFAULTS,options);return this.each(function(){var wcount,$this=$(this),$target=$("#"+settings.target),$msgBox=($('<div id="alw_msg_'+$this.attr("id")+'"/>').insertBefore($this),$("#alw_msg_"+$this.attr("id")));if($msgBox.hide(),$this.addClass("alw_control"),$this.removeClass("alw_loaderror"),void 0===$this.attr("id")&&(0<(wcount=$(".ands_location_map_container").length)?$this.attr("id","ands_location_map_container-"+(wcount+=1)):$this.attr("id","ands_location_map_container"),$this.addClass("ands_location_map_container")),$target.length){if(void 0!==$target.data("alwtarget"))return void showError("The specified target field `"+escape(settings.target)+"` is being used as a target for another map (id: `"+$target.data("alwtarget")+"`). Review plugin configuration and try again.",$this)}else($target=$('<input id="'+settings.target+'" name="'+settings.target+'" data-alwtarget="'+$this.attr("id")+'" type="hidden" />')).insertAfter($this);!1!==settings.lonLat&&$target.val(settings.lonLat),$this.data(WIDGET_NS,{input_field_orig:null,pushpin:null,pushpin_edit:null,shadow:null,polygon:null,geocoder:null,error_message:null,map:null,marker:null,drawing_manager:null,tools:{},feature_types:{},marker_listeners:[]});try{if(settings.start=getCoordsFromString(settings.start)[0],!(settings.start instanceof google.maps.LatLng))return showError("Invalid start point: specify 'start' option as '<i>longitude</i>, <i>latitude</i>'"),$this}catch(e){return showError("Invalid start point"),$this}if(!1!==settings.mode&&"search"!==settings.mode&&"coords"!==settings.mode)return showError("Invalid mode: currently, only <i>search</i> and <i>coords</i> are valid modes"),$this;function makeMapWidget(){$.each(["feature"],function(idx,type){type=settings.endpoint+"?feature="+type+"&callback=?";$.getJSON(type,function(data){if("OK"==data.status){ENABLE_GAZETTEER=!0,!function(data){for(var widget_data=$this.data(WIDGET_NS),i=0;i<data.items.length;i++){var title=data.items[i].title,id=data.items[i].id;widget_data.feature_types[id]=title}$this.data(WIDGET_NS,widget_data)}(data);var data=null,widget_data=$this.data(WIDGET_NS);try{!function(value){var widget_data=$this.data(WIDGET_NS);widget_data.input_field_orig=value,$this.data(WIDGET_NS,widget_data)}($target.val());var mapCanvasId="alw_canvas_"+$this.attr("id"),mapCanvas=(!function(welem){var id=null,html='<div class="alw_toolbar">',widget_data=$this.data(WIDGET_NS);id="alw_tool_point"+$this.attr("id"),widget_data.tools[id]=!1,$this.on("click","#"+id,null,function(){var tool,widget_data,active;tool="#alw_tool_point"+$this.attr("id"),tool=$(tool),widget_data=$this.data(WIDGET_NS),active=getToolActive(tool),resetTools(settings.jumpToPoint),widget_data.map.setOptions({draggableCursor:"crosshair"}),active||(setToolActive(tool,!0),1===(active=getCoordsFromString($target.val())).length&&createMarker(active[0],!0),widget_data.marker_listeners.push(google.maps.event.addListener(widget_data.map,"click",function(e){e.latLng&&($target.val(e.latLng.lng().toFixed(6)+","+e.latLng.lat().toFixed(6)),resetTools(settings.jumpToPoint))})),settings.jumpToPoint&&centreMap())}),html+='<span class="alw_tool" id="'+id+'" title="Mark a point on the map">point</span>',id="alw_tool_region"+$this.attr("id"),$this.on("click","#"+id,null,function(){var tool=$("#alw_tool_region"+$this.attr("id")),widget_data=(tool=$(tool),$this.data(WIDGET_NS)),active=getToolActive(tool);resetTools(),active||(setToolActive(tool,!0),2<(active=getCoordsFromString($target.val())).length?(createPolygon(active,!0),centreMap()):function(latLng){var widget_data=$this.data(WIDGET_NS);$.each(widget_data.marker_listeners,function(idx,listener){google.maps.event.removeListener(listener)}),widget_data.drawing_manager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!1,polygonOptions:{fillColor:"#ff0000",paths:[latLng],fillOpacity:.2,strokeColor:"#ff0000",strokeWeight:2,clickable:!0,zIndex:1,editable:!0}}),widget_data.drawing_manager.setMap(widget_data.map),$this.data(WIDGET_NS,widget_data),google.maps.event.addListener(widget_data.drawing_manager,"polygoncomplete",function(polygon){var widget_data=$this.data(WIDGET_NS);savePolygonString(polygon.getPath()),polygon.setMap(null),widget_data.drawing_manager.setMap(null),resetTools()})}("")),$this.data(WIDGET_NS,widget_data)}),widget_data.tools[id]=!1,html+='<span class="alw_tool" id="'+id+'" title="Draw a polygon on the map to mark a region">region</span>',id="alw_tool_box"+$this.attr("id"),$this.on("click","#"+id,null,function(){var widget_data;widget_data=$this.data(WIDGET_NS),$.each(widget_data.marker_listeners,function(idx,listener){google.maps.event.removeListener(listener)}),widget_data.drawing_manager=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.RECTANGLE,drawingControl:!1,polygonOptions:{fillColor:"#ff0000",fillOpacity:.2,strokeColor:"#ff0000",strokeWeight:2,clickable:!0,zIndex:1,editable:!0}}),widget_data.drawing_manager.setMap(widget_data.map),$this.data(WIDGET_NS,widget_data),google.maps.event.addListener(widget_data.drawing_manager,"overlaycomplete",function(e){var geoCodeRectangle=e.overlay,geoCodeRectangle=(widget_data.box=geoCodeRectangle).getBounds(),n=geoCodeRectangle.getNorthEast().lat().toFixed(6),e=geoCodeRectangle.getNorthEast().lng().toFixed(6),s=geoCodeRectangle.getSouthWest().lat().toFixed(6),geoCodeRectangle=geoCodeRectangle.getSouthWest().lng().toFixed(6),e=geoCodeRectangle+","+n+" "+e+","+n+" "+e+","+s+" "+geoCodeRectangle+","+s+" "+geoCodeRectangle+","+n,s=(clearMap(),$target.val(e),getCoordsFromString(e)),geoCodeRectangle=new google.maps.Polygon({paths:s,map:widget_data.map,strokeColor:"#008dce",strokeOpacity:.7,strokeWeight:2,fillColor:"#008dce",fillOpacity:.2,editable:!1});widget_data.polygon=geoCodeRectangle,$this.data(WIDGET_NS,widget_data)})}),widget_data.tools[id]=!1,html+='<span class="alw_tool" id="'+id+'" title="Draw a polygon on the map to mark a region">box</span>',id="alw_tool_search"+$this.attr("id"),widget_data.tools[id]=!1,$this.on("click","#"+id,null,function(){showAddressSearchDialog($("#alw_tool_search"+$this.attr("id")))}),html+='<span class="alw_tool" id="'+id+'" title="Search for a place or region to mark on the map">search...</span>',id="alw_tool_text"+$this.attr("id"),$this.on("click","#"+id,null,function(){showLonLatDialog($("#alw_tool_text"+$this.attr("id")))}),widget_data.tools[id]=!1,html+='<span class="alw_tool" id="'+id+'" title="Enter longitude,latitude pairs to mark a point or a region on the map">coordinates...</span>',id="alw_clear"+$this.attr("id"),$this.on("click","#"+id,null,function(){setMapFromData("",{centre:!0})}),html+='<span class="alw_special_tool cleartool" id="'+id+'" title="Clear the marker/region data">clear</span>',null!==widget_data.input_field_orig&&""!==widget_data.input_field_orig&&(id="alw_reset"+$this.attr("id"),$this.on("click","#"+id,null,function(){setMapFromData($this.data(WIDGET_NS).input_field_orig,{centre:!0})}),html+='<span class="alw_special_tool" id="'+id+'" title="Reset the map to its initial state">reset</span>');html+="</div>",$this.data(WIDGET_NS,widget_data),welem.append(html)}($this),!function(welem){var mapDialogId="alw_search_"+$this.attr("id"),searchResultsDivId="alw_search_results"+$this.attr("id"),searchResultsTextfieldId="alw_search_textfield"+$this.attr("id");makeDialog(welem,mapDialogId,function(){return $(this).css("overflow","hidden"),ENABLE_GAZETTEER?'<div class="alw_dialog_text"><i>Search for a region or place to mark on the map</i></div><label style="cursor:hand"><input type="radio" id="geocoderSelector.gazetteer" name="geocoderSelector" checked="checked" value="geocoderSelector.gazetteer" /> Australian Gazetteer</label><label style="cursor:hand"><input type="radio" id="geocoderSelector.google" name="geocoderSelector" value="geocoderSelector.google" /> Google</label><div class="alw_dialog_text"><input type="text" id="'+searchResultsTextfieldId+'" style="margin: 0px; width: 210px;" />&nbsp;<button type="button" class="alw_button search">search</button></div><div id="'+searchResultsDivId+'" style="padding: 0px 0px 0px 8px; margin: 0px 0px 0px 0px; height: 138px; overflow:auto;"></div></div>':'<div class="alw_dialog_text"><i>Search for a region or place to mark on the map</i></div><div class="alw_dialog_text"><input type="text" id="'+searchResultsTextfieldId+'" style="margin: 0px; width: 210px;" />&nbsp;<button type="button" class="alw_button search">search</button></div><div id="'+searchResultsDivId+'" style="padding: 0px 0px 0px 8px; margin: 0px 0px 0px 0px; height: 138px; overflow:auto;"></div></div>'}),$this.on("click","#"+mapDialogId+" div.alw_dialog_text button.alw_button.search",null,function(){doSearch()}),$this.on("click","#"+mapDialogId+" div.alw_buttonbar button.alw_button.cancel",null,function(){resetTools()}),$this.on("click","#alw_search_results"+$this.attr("id")+" div.alw_search_result",null,function(){setMapFromData($(this).data("coord"),{centre:!0})}),$this.on("keypress","#"+searchResultsTextfieldId,null,function(event){var result=!0;13===event.which&&(result=!1,doSearch());return result})}($this),!function(welem){var mapDialogId="alw_lonlat_"+$this.attr("id");makeDialog(welem,mapDialogId,function(){var content=$('<div class="alw_dialog_text"><i>Enter space delimited longitude,latitude pairs</i></div>'),textarea=$('<textarea style="display: block; margin: auto; width: 278px; height: 174px;"></textarea>');return textarea.attr("id","alw_lonlat_textarea"+$this.attr("id")),content.append(textarea),content},function(){return'&nbsp;<button type="button" class="alw_button set" title="Set the map to show this point or region">set</button>'}),$this.on("click","#"+mapDialogId+" button.alw_button.cancel",null,function(){resetTools()}),$this.on("click","#"+mapDialogId+" button.alw_button.set",null,function(){setMapFromData(tidyLonLatText($("#alw_lonlat_textarea"+$this.attr("id")).val()),{validate:!0,centre:!0})})}($this),$this.append('<div class="alw_canvas" id="'+mapCanvasId+'"/>'),widget_data.pushpin_edit||(widget_data.pushpin_edit=new google.maps.MarkerImage(settings.gasset_protocol+"maps.google.com/intl/en_us/mapfiles/ms/micons/orange.png",new google.maps.Size(32,32),new google.maps.Point(0,0),new google.maps.Point(16,32))),widget_data.pushpin||(widget_data.pushpin=new google.maps.MarkerImage(settings.gasset_protocol+"maps.google.com/intl/en_us/mapfiles/ms/micons/blue.png",new google.maps.Size(32,32),new google.maps.Point(0,0),new google.maps.Point(16,32))),widget_data.shadow=new google.maps.MarkerImage(settings.gasset_protocol+"maps.google.com/intl/en_us/mapfiles/ms/micons/msmarker.shadow.png",new google.maps.Size(36,32),new google.maps.Point(0,0),new google.maps.Point(16,32)),$("#"+mapCanvasId)),myOptions={zoom:settings.zoom,disableDefaultUI:!0,center:settings.start,panControl:!0,zoomControl:!0,mapTypeControl:!0,scaleControl:!0,streetViewControl:!1,overviewMapControl:!0,mapTypeId:google.maps.MapTypeId.TERRAIN};data=new google.maps.Map(mapCanvas[0],myOptions),new google.maps.LatLngBounds,google.maps.event.addListenerOnce(data,"idle",function(){setMapFromInputField(!0)});if(data.setOptions({draggableCursor:"default"}),data.setOptions({draggingCursor:"move"}),widget_data.map=data,widget_data.geocoder=new google.maps.Geocoder,$this.data(WIDGET_NS,widget_data),!1!==settings.mode)switch(settings.mode){case"search":showAddressSearchDialog($("#alw_tool_search"+$this.attr("id")));break;case"coords":showLonLatDialog($("#alw_tool_text"+$this.attr("id")))}}catch(e){showError("The mapping tool has failed to load. Your browser must allow non-HTTPS content to load on this page in order to use this tool.<br/><br/>(JSException: "+e+")")}}})})}function getErrorMessage(){return $this.data(WIDGET_NS).error_message}function setErrorMessage(message){var widget_data=$this.data(WIDGET_NS);widget_data.error_message=message,$this.data(WIDGET_NS,widget_data)}function showError(message,container){void 0===container&&(container=$this),void 0===message&&(message=getErrorMessage()),container.addClass("alw_loaderror"),container.html(message),container.is(":hidden")&&($('<a style="float:right" id = "'+container.attr("id")+'-close" href="#">[X]</a><br/>').prependTo(container),$(document).on("click","#"+container.attr("id")+"-close",function(event){return event.preventDefault(),$(this).parent().hide(),!1}),container.show())}function setToolActive(tool,active){tool=$(tool);var widget_data=$this.data(WIDGET_NS);(widget_data.tools[tool.attr("id")]=active)?tool.addClass("alw_tool_active").removeClass("alw_tool"):tool.removeClass("alw_tool_active").addClass("alw_tool"),$this.data(WIDGET_NS,widget_data)}function getToolActive(tool){return tool=$(tool),$this.data(WIDGET_NS).tools[tool.attr("id")]}function resetTools(centre){centre=void 0===centre;var widget_data=$this.data(WIDGET_NS);$.each(["alw_tool_point","alw_tool_region","alw_tool_box","alw_tool_text","alw_lonlat_","alw_lonlat_textarea","alw_tool_search","alw_search_"],function(idx,prefix){var object=$("#"+prefix+$this.attr("id"));switch(setToolActive(object,!1),prefix){case"alw_lonlat_":case"alw_search_":object.hide();break;case"alw_lonlat_textarea":object.val("")}}),widget_data.map.setOptions({draggableCursor:"default"}),widget_data.map.setOptions({draggingCursor:"move"}),$.each(widget_data.marker_listeners,function(idx,listener){google.maps.event.removeListener(listener)}),null!==widget_data.drawing_manager&&widget_data.drawing_manager.setMap(null),setMapFromData($target.val(),{centre:centre,reset:!1}),$this.data(WIDGET_NS,widget_data)}function tidyLonLatText(lonlatText){return""!==lonlatText&&(lonlatText=(lonlatText=lonlatText.replace(new RegExp("\\s*,\\s*","g"),",")).replace(new RegExp("\\s+","g")," "),lonlatText=$.trim(lonlatText)),lonlatText}function getCoordsFromString(cstr){var coords=new Array,cstr=tidyLonLatText(cstr);if(""!==cstr&&validateLonLatText(cstr))for(var coordsStr=cstr.split(" "),i=0;i<coordsStr.length;i++){var coordsPair=coordsStr[i].split(",");coords[i]=new google.maps.LatLng(coordsPair[1],coordsPair[0])}return coords}function validateLonLatText(lonlatText){var valid=!0;if(""!==lonlatText){var lat,coordsPair,coords=lonlatText.split(" ");2===coords.length&&(setErrorMessage("The coordinates don't represent a point or a region."),valid=!1);for(var i=0;i<coords.length&&valid;i++){if(lat=(coordsPair=coords[i].split(","))[1],coordsPair=coordsPair[0],isNaN(lat)||isNaN(coordsPair)){setErrorMessage("Some coordinates are not numbers."),valid=!1;break}if(90<Math.abs(lat)||180<Math.abs(coordsPair)){setErrorMessage("Some coordinates have invalid values."),valid=!1;break}i===coords.length-1&&coords[0]!==coords[i]&&(setErrorMessage("The coordinates don't represent a point or a region. To define a region the last point needs to be the same as the first."),valid=!1)}}return valid}function clearMap(){!function(){var widget_data=$this.data(WIDGET_NS);null!==widget_data.marker&&(widget_data.marker.setMap(null),widget_data.marker=null);$this.data(WIDGET_NS,widget_data)}(),function(){var widget_data=$this.data(WIDGET_NS);null!==widget_data.polygon&&(widget_data.polygon.setMap(null),widget_data.polygon=null);void 0!==widget_data.box&&null!==widget_data.box&&(widget_data.box.setMap(null),widget_data.box=null);$this.data(WIDGET_NS,widget_data)}();var widget_data=$this.data(WIDGET_NS);null!==widget_data.drawing_manager&&(widget_data.drawing_manager.setMap(null),$this.data(WIDGET_NS,widget_data)),function(){var widget_data=$this.data(WIDGET_NS);google.maps.event.trigger(widget_data.map,"resize")}()}function centreMap(){var widget_data=$this.data(WIDGET_NS);if(null!==widget_data.polygon){for(var bounds=new google.maps.LatLngBounds,polygonCoords=widget_data.polygon.getPath().getArray(),i=0;i<polygonCoords.length;i++)bounds.extend(polygonCoords[i]);widget_data.map.fitBounds(bounds)}null!==widget_data.marker&&settings.jumpToPoint&&widget_data.map.setCenter(widget_data.marker.getPosition()),$this.data(WIDGET_NS,widget_data)}function createMarker(latlng,editable){var widget_data=$this.data(WIDGET_NS),marker=(clearMap(),null);editable?(marker=new google.maps.Marker({position:latlng,map:widget_data.map,icon:widget_data.pushpin_edit,shadow:widget_data.shadow,draggable:!0}),google.maps.event.addListener(marker,"dragend",function(){var latlng=marker.getPosition();$target.val(latlng.lng().toFixed(6)+","+latlng.lat().toFixed(6))})):marker=new google.maps.Marker({position:latlng,map:widget_data.map,icon:widget_data.pushpin,shadow:widget_data.shadow,clickable:!1}),widget_data.marker=marker,$this.data(WIDGET_NS,widget_data),$target.val(latlng.lng().toFixed(6)+","+latlng.lat().toFixed(6))}function createPolygon(coords,editable){var widget_data=$this.data(WIDGET_NS),polygon=(clearMap(),null);editable?(polygon=new google.maps.Polygon({paths:coords,map:widget_data.map,strokeColor:"#ff0000",strokeOpacity:.7,strokeWeight:2,fillColor:"#ff0000",fillOpacity:.2,editable:!0,clickable:!0}),google.maps.event.addListener(polygon,"click",function(e){savePolygonString(polygon.getPath())}),google.maps.event.addListener(polygon,"mouseup",function(e){savePolygonString(polygon.getPath())}),google.maps.event.addListener(polygon,"mouseout",function(e){savePolygonString(polygon.getPath())})):polygon=new google.maps.Polygon({paths:coords,map:widget_data.map,strokeColor:"#008dce",strokeOpacity:.7,strokeWeight:2,fillColor:"#008dce",fillOpacity:.2,editable:!1}),widget_data.polygon=polygon,$this.data(WIDGET_NS,widget_data)}function savePolygonString(path){for(var coords=path.getArray(),polyString="",i=0;i<coords.length;i++)var pLat=coords[i].lat(),pLng=coords[i].lng(),polyString=0===i?pLng.toFixed(6)+","+pLat.toFixed(6):polyString+" "+pLng.toFixed(6)+","+pLat.toFixed(6);polyString=polyString+" "+coords[0].lng().toFixed(6)+","+coords[0].lat().toFixed(6),$target.val(polyString),settings.return_callback&&"function"==typeof settings.return_callback&&settings.return_callback(polyString)}function showAddressSearchDialog(tool){tool=$(tool);$this.data(WIDGET_NS);var active=getToolActive(tool);resetTools(),active||(setToolActive(tool,!0),$("#alw_search_"+$this.attr("id")).show(),(active=$("#alw_search_textfield"+$this.attr("id"))).focus(),active.select())}function doSearch(){var widget_data=$this.data(WIDGET_NS),searchResultsTextfield=$("#alw_search_textfield"+$this.attr("id")),searchResultsTextfield=$.trim(searchResultsTextfield.val()),searchResultsDiv=$("#alw_search_results"+$this.attr("id"));""!==searchResultsTextfield?(searchResultsDiv.html("Searching..."),"geocoderSelector.gazetteer"===$("input[name=geocoderSelector]:checked").val()?function(searchText){searchText=settings.endpoint+"?searchText=*"+encodeURIComponent(searchText)+"*&limit=14&callback=?";$.getJSON(searchText,function(data){!function(data){var widget_data=$this.data(WIDGET_NS),resultText="",coordString="";if("0"===data.items_count)resultText="No locations found";else for(var i=0;i<data.items.length;i++){data.items[i].coords;coordString=data.items[i].lat+","+data.items[i].lng;for(var typetext="",j=0;j<data.items[i].types.length;j++)0!==j&&(typetext+=", "),widget_data.feature_types[data.items[i].types[j]]?typetext+=widget_data.feature_types[data.items[i].types[j]]:typetext+=data.items[i].types[j];resultText+='<div class="alw_search_result" data-coord="'+coordString+'" title="Set the map with this search result">&#8226;&nbsp;'+data.items[i].title+" ("+typetext+")</div>"}$("#alw_search_results"+$this.attr("id")).html(resultText)}(data)})}(searchResultsTextfield):widget_data.geocoder.geocode({address:searchResultsTextfield},function(results,status){!function(results,status){var markerBullet="",resultText="",coordString="";if(status!==google.maps.GeocoderStatus.OK)resultText="No locations found";else for(var i=0;i<results.length;i++){var nE,sW;results[i].geometry.location_type;markerBullet=results[i].geometry.bounds?(nE=results[i].geometry.bounds.getNorthEast(),sW=results[i].geometry.bounds.getSouthWest(),coordString=nE.lng().toFixed(6)+","+nE.lat().toFixed(6)+" ",coordString=(coordString=(coordString=(coordString+=sW.lng().toFixed(6)+","+nE.lat().toFixed(6)+" ")+sW.lng().toFixed(6)+","+sW.lat().toFixed(6)+" ")+nE.lng().toFixed(6)+","+sW.lat().toFixed(6)+" ")+nE.lng().toFixed(6)+","+nE.lat().toFixed(6),"&#9633;"):(coordString=results[i].geometry.location.lng().toFixed(6)+","+results[i].geometry.location.lat().toFixed(6),"&#8226;"),resultText+='<div class="alw_search_result" data-coord="'+coordString+'" title="Set the map with this search result">'+markerBullet+"&nbsp;"+results[i].formatted_address+"</div>"}$("#alw_search_results"+$this.attr("id")).html(resultText)}(results,status)})):searchResultsDiv.html("Nothing to search on! Try entering some terms in the text box above")}function makeDialog(append_to,dialog_id,content_for,toolbar_for){"function"!=typeof toolbar_for&&(toolbar_for=function(){return""}),"function"!=typeof content_for&&(content_for=function(){return""});var dialog_shell=$('<div class="alw_dialog_container">');dialog_shell.attr("id",dialog_id),dialog_shell.append('<img class="alw_dialog_back src="'+settings.gasset_protocol+'maps.google.com/mapfiles/iws_s.png" alt="" />'),dialog_shell.append('<div class="alw_dialog_outer"><div class="alw_dialog_inner"><div class="alw_dialog_content">'),dialog_shell.find("div.alw_dialog_content").html(content_for.call()),dialog_shell.find("div.alw_dialog_inner").append('<div class="alw_buttonbar"><button type="button" class="alw_button cancel">cancel</button>'+toolbar_for.call()+"</div>"),append_to.append(dialog_shell)}function showLonLatDialog(tool){var active=getToolActive(tool=$(tool));resetTools(),active||(setToolActive(tool,!0),(active=$("#alw_lonlat_textarea"+$this.attr("id"))).val($target.val()),$("#alw_lonlat_"+$this.attr("id")).show(),active.focus())}function setMapFromData(data,options){(options=$.extend({},{validate:!1,centre:!1,reset:!0},options)).validate&&validateLonLatText(data)||!options.validate?($target.val(data),options.reset&&resetTools(),setMapFromInputField(options.centre)):showError("Problem setting map with supplied data:<br/>"+getErrorMessage()+"<br/>Cancel or correct the error and set.",$msgBox)}function setMapFromInputField(centred){clearMap();var coords=getCoordsFromString($target.val());1===coords.length?createMarker(coords[0],!1):2<coords.length&&createPolygon(coords,!1),centred&&centreMap()}makeMapWidget()})}};$.fn.ands_location_widget=function(method){return methods[method]?methods[method].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof method&&method?void $.error("Method "+method+" does not exist for the ANDS Location Capture Widget"):methods.init.apply(this,arguments)}}(jQuery);