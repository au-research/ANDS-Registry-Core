!function($){function bind_orcid_plugin(obj,settings){if(obj.parent().is("span.inputs_group")){var p=obj.closest(".controls");obj.p=p}else{obj.wrap(settings.wrap_html);var p=obj.parent();obj.p=p}if((settings.pre_lookup||"true"===obj.attr("data-autolookup"))&&_lookup(obj,settings),settings.lookup){var lookup_btn=$("<button>").addClass(settings.lookup_class).html(settings.lookup_text);p.append(lookup_btn),$(lookup_btn).on("click",function(e){e.preventDefault(),_lookup(obj,settings)})}if(settings.search){var search_btn=$("<button>").addClass(settings.search_class).html(settings.search_text),search_html=settings.query_text+' <input type="text" class="orcid_search_input"/> <a class="search_orcid">'+settings.search_text_btn+'</a><div class="orcid_search_result"></div><a class="close_search">'+settings.close_search_text_btn+"</a>",search_div=$("<div>").addClass(settings.search_div_class).html(search_html);settings.pre_open_search||$(search_div).hide(),p.append(search_btn).append(search_div),$(search_btn).on("click",function(e){e.preventDefault(),_search_form(obj,settings)}),$("input.orcid_search_input",p).on("keypress",function(e){return 13==e.keyCode?(_search($(this).val(),obj,settings),!1):void 0}),$(".search_orcid",p).on("click",function(e){e.preventDefault(),e.stopPropagation();var query=$(".orcid_search_input",p).val();_search(query,obj,settings)}),$(".close_search",p).on("click",function(){$("."+settings.search_div_class,p).slideUp()})}settings.before_html&&obj.before(settings.before_html),$(obj).on("keypress",function(e){return 13==e.keyCode?(_lookup(obj,settings),!1):void 0})}function _lookup(obj,settings){var value=obj.val();$.ajax({url:settings.lookup_endpoint+encodeURIComponent(value)+"?callback=?",dataType:"jsonp",timeout:1e3,success:function(data){if(settings.lookup_success_handler&&"function"==typeof settings.lookup_success_handler)settings.lookup_success_handler(data,obj,settings);else{_clean(obj,settings);var html=_constructORCIDHTML(data["orcid-profile"],settings),result_div=$("<div>").addClass(settings.result_success_class).html(html);obj.p.append(result_div),settings.post_lookup_success_handler&&"function"==typeof settings.post_lookup_success_handler&&settings.post_lookup_success_handler(data,obj,settings)}},error:function(xhr){if(settings.lookup_error_handler&&"function"==typeof settings.lookup_error_handler)settings.lookup_error_handler(xhr);else{_clean(obj,settings);var result_div=$("<div>").addClass(settings.result_error_class).html(settings.nohits_msg);obj.p.append(result_div),obj.addClass("error")}}})}function _constructORCIDHTML(obj,settings){var resStr="";resStr+="<div class='"+settings.info_box_class+"'>",resStr+="<h6>ORCID Identifier</h6>";var orcid=eval(obj["orcid-identifier"]);if(resStr+=orcid.path,obj["orcid-bio"].biography&&""!=obj["orcid-bio"].biography.value){resStr+="<h6>Biography</h6>";var biography=obj["orcid-bio"].biography.value;biography=biography.replace(/"/g,"&quot;"),resStr+="<p>"+biography+"</p>"}if(obj["orcid-bio"]["personal-details"]&&(resStr+="<h6>Personal Details</h6>",resStr+="<p>",obj["orcid-bio"]["personal-details"]["credit-name"]&&(resStr+="Credit name: "+obj["orcid-bio"]["personal-details"]["credit-name"].value+" <br />"),obj["orcid-bio"]["personal-details"]["family-name"]&&(resStr+="Family name: "+obj["orcid-bio"]["personal-details"]["family-name"].value+" <br />"),obj["orcid-bio"]["personal-details"]["given-names"]&&(resStr+="Given names: "+obj["orcid-bio"]["personal-details"]["given-names"].value+" <br />"),obj["orcid-bio"]["personal-details"]["other-names"])){resStr+="Other names: ";var count=0;for(i=0;i<obj["orcid-bio"]["personal-details"]["other-names"].length-1;i++)resStr+=obj["orcid-bio"]["personal-details"]["other-names"]["other-name"][i].value+", ",count++;resStr+=obj["orcid-bio"]["personal-details"]["other-names"]["other-name"][count].value+"<br />"}if(obj["orcid-bio"].keywords){resStr+="<h6>Keywords</h6>";var count=0;for(i=0;i<obj["orcid-bio"].keywords.keyword.length-1;i++)resStr+=obj["orcid-bio"].keywords.keyword[i].value+", ",count++;resStr+=obj["orcid-bio"].keywords.keyword[count].value+"<br />"}if(obj["orcid-bio"]["researcher-urls"]){resStr+="<h6>Research URLs</h6>";var count=0;for(i=0;i<obj["orcid-bio"]["researcher-urls"]["researcher-url"].length-1;i++)""!=obj["orcid-bio"]["researcher-urls"]["researcher-url"][i].url.value&&(resStr+="URL : "+obj["orcid-bio"]["researcher-urls"]["researcher-url"][i].url.value+"<br /> "),obj["orcid-bio"]["researcher-urls"]["researcher-url"][i]["url-name"].value&&(resStr+="URL Name : "+obj["orcid-bio"]["researcher-urls"]["researcher-url"][i]["url-name"].value+"<br /> "),count++;obj["orcid-bio"]["researcher-urls"]["researcher-url"][count].url&&""!=obj["orcid-bio"]["researcher-urls"]["researcher-url"][count].url.value&&(resStr+="URL : "+obj["orcid-bio"]["researcher-urls"]["researcher-url"][count].url.value+"<br />"),obj["orcid-bio"]["researcher-urls"]["researcher-url"][count]["url-name"]&&""!=obj["orcid-bio"]["researcher-urls"]["researcher-url"][count]["url-name"].value&&(resStr+="URL Name : "+obj["orcid-bio"]["researcher-urls"]["researcher-url"][count]["url-name"].value+"<br />")}return resStr+="</div>"}function isset(variable){return"undefined"!=typeof variable&&null!==variable?!0:!1}function _search(query,obj,settings){{var p=obj.p;p.find("."+settings.orcid_search_result)}""==$.trim(query)?$(".orcid_search_result",p).html("Please enter a search string"):($(".orcid_search_result",p).html("Loading..."),$.ajax({url:settings.search_endpoint+encodeURIComponent(query)+"&start=0&rows=10&wt=json&callback=?",dataType:"jsonp",success:function(data){if(settings.success_handler&&"function"==typeof settings.success_handler)settings.success_handler(data,obj,settings);else if(data["orcid-search-results"]){var html="<ul>";$.each(data["orcid-search-results"]["orcid-search-result"],function(){var titleStr="";settings.tooltip&&(titleStr='title="'+_constructORCIDHTML(this["orcid-profile"],settings)+'"');var orcid=this["orcid-profile"]["orcid-identifier"].path,given=this["orcid-profile"]["orcid-bio"]["personal-details"]["given-names"].value||"",family=this["orcid-profile"]["orcid-bio"]["personal-details"]["family-name"].value||"";html+="<li>",html+='<a class="select_orcid_search_result preview" '+titleStr+' orcid-id="'+orcid+'">'+given+" "+family+"</a>",html+="</li>"}),html+="</ul>",$(".orcid_search_result",p).html(html)}else $(".orcid_search_result",p).html(settings.nohits_msg);$(".select_orcid_search_result",p).on("click",function(){obj.val($(this).attr("orcid-id")),_lookup(obj,settings),settings.auto_close_search&&_search_form(obj,settings)}),settings.tooltip&&$(".preview").each(function(){$(this).qtip({content:{text:$(this).attr("title")},position:{my:"left center",at:"right center",viewport:$(window)},show:{event:"mouseover"},hide:{event:"mouseout"},style:{classes:"ui-tooltip-light ui-tooltip-shadow orcidPreview",width:550}})})},error:function(xhr){settings.error_handler&&"function"==typeof settings.error_handler?settings.error_handler(xhr):console.error(xhr)}}))}function _clean(obj,settings){obj.removeClass("error"),obj.p.children("."+settings.result_error_class).length>0&&obj.p.children("."+settings.result_error_class).remove(),obj.p.children("."+settings.result_success_class).length>0&&obj.p.children("."+settings.result_success_class).remove()}function _search_form(obj,settings){obj.p.children("."+settings.search_div_class).slideToggle()}var WIDGET_NAME="ANDS Orcid service",WIDGET_ID="_orcid_widget_list";$.fn.orcid_widget=function(options,param){param="undefined"==typeof param?!1:param;var settings,defaults={search_endpoint:"http://pub.orcid.org/v1.1/search/orcid-bio?q=",lookup_endpoint:"http://pub.orcid.org/v1.1/",pre_lookup:!1,search:!0,pre_open_search:!1,tooltip:!1,info_box_class:"info-box",search_text:'<i class="icon-search"></i> Search',search_class:"orcid_search btn btn-default btn-small",lookup:!0,lookup_text:"Look up",lookup_class:"orcid_lookup btn btn-default btn-small",before_html:'<span class="orcid_before_html">http://orcid.org/</span>',wrap_html:'<div class="orcid_wrapper"></div>',result_success_class:"orcid_success_div",result_error_class:"orcid_error_div",search_div_class:"orcid_search_div",nohits_msg:'<p>No matches found<br/>If you wish to register for an orcid please click <a href="https://orcid.org/register" target="_blank" style="float:none;padding:0px">here</a></p>',query_text:"Search Query:",search_text_btn:"Search",close_search_text_btn:"[x]",lookup_error_handler:!1,lookup_success_handler:!1,post_lookup_success_handler:!1,auto_close_search:!0};if("string"!=typeof options){settings=$.extend({},defaults,options),settings.list_class="undefined"==typeof settings.list_class?"":settings.list_class,settings._wname=WIDGET_NAME,settings._wid=WIDGET_ID;try{return this.each(function(){var $this=$(this);bind_orcid_plugin($this,settings)})}catch(err){alert(err)}}},$(".orcid_widget").each(function(){{var elem=$(this);elem.orcid_widget()}})}(jQuery);