(function(){window.$jit=function(e){e=e||window;for(var t in $jit){if($jit[t].$extend){e[t]=$jit[t]}}};$jit.version="2.0.1";var e=function(e){return document.getElementById(e)};e.empty=function(){};e.extend=function(e,t){for(var n in t||{})e[n]=t[n];return e};e.lambda=function(e){return typeof e=="function"?e:function(){return e}};e.time=Date.now||function(){return+(new Date)};e.splat=function(t){var n=e.type(t);return n?n!="array"?[t]:t:[]};e.type=function(t){var n=e.type.s.call(t).match(/^\[object\s(.*)\]$/)[1].toLowerCase();if(n!="object")return n;if(t&&t.$$family)return t.$$family;return t&&t.nodeName&&t.nodeType==1?"element":n};e.type.s=Object.prototype.toString;e.each=function(t,n){var r=e.type(t);if(r=="object"){for(var i in t)n(t[i],i)}else{for(var s=0,o=t.length;s<o;s++)n(t[s],s)}};e.indexOf=function(e,t){if(Array.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++){if(e[n]===t)return n}return-1};e.map=function(t,n){var r=[];e.each(t,function(e,t){r.push(n(e,t))});return r};e.reduce=function(e,t,n){var r=e.length;if(r==0)return n;var i=arguments.length==3?n:e[--r];while(r--){i=t(i,e[r])}return i};e.merge=function(){var t={};for(var n=0,r=arguments.length;n<r;n++){var i=arguments[n];if(e.type(i)!="object")continue;for(var s in i){var o=i[s],u=t[s];t[s]=u&&e.type(o)=="object"&&e.type(u)=="object"?e.merge(u,o):e.unlink(o)}}return t};e.unlink=function(t){var n;switch(e.type(t)){case"object":n={};for(var r in t)n[r]=e.unlink(t[r]);break;case"array":n=[];for(var i=0,s=t.length;i<s;i++)n[i]=e.unlink(t[i]);break;default:return t}return n};e.zip=function(){if(arguments.length===0)return[];for(var e=0,t=[],n=arguments.length,r=arguments[0].length;e<r;e++){for(var i=0,s=[];i<n;i++){s.push(arguments[i][e])}t.push(s)}return t};e.rgbToHex=function(e,t){if(e.length<3)return null;if(e.length==4&&e[3]==0&&!t)return"transparent";var n=[];for(var r=0;r<3;r++){var i=(e[r]-0).toString(16);n.push(i.length==1?"0"+i:i)}return t?n:"#"+n.join("")};e.hexToRgb=function(e){if(e.length!=7){e=e.match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);e.shift();if(e.length!=3)return null;var t=[];for(var n=0;n<3;n++){var r=e[n];if(r.length==1)r+=r;t.push(parseInt(r,16))}return t}else{e=parseInt(e.slice(1),16);return[e>>16,e>>8&255,e&255]}};e.destroy=function(t){e.clean(t);if(t.parentNode)t.parentNode.removeChild(t);if(t.clearAttributes)t.clearAttributes()};e.clean=function(t){for(var n=t.childNodes,r=0,i=n.length;r<i;r++){e.destroy(n[r])}};e.addEvent=function(e,t,n){if(e.addEventListener)e.addEventListener(t,n,false);else e.attachEvent("on"+t,n)};e.addEvents=function(t,n){for(var r in n){e.addEvent(t,r,n[r])}};e.hasClass=function(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>-1};e.addClass=function(t,n){if(!e.hasClass(t,n))t.className=t.className+" "+n};e.removeClass=function(e,t){e.className=e.className.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)"),"$1")};e.getPos=function(e){function r(e){var t={x:0,y:0};while(e&&!s(e)){t.x+=e.offsetLeft;t.y+=e.offsetTop;e=e.offsetParent}return t}function i(e){var t={x:0,y:0};while(e&&!s(e)){t.x+=e.scrollLeft;t.y+=e.scrollTop;e=e.parentNode}return t}function s(e){return/^(?:body|html)$/i.test(e.tagName)}var t=r(e);var n=i(e);return{x:t.x-n.x,y:t.y-n.y}};e.event={get:function(e,t){t=t||window;return e||t.event},getWheel:function(e){return e.wheelDelta?e.wheelDelta/120:-(e.detail||0)/3},isRightClick:function(e){return e.which==3||e.button==2},getPos:function(e,t){t=t||window;e=e||t.event;var n=t.document;n=n.documentElement||n.body;if(e.touches&&e.touches.length){e=e.touches[0]}var r={x:e.pageX||e.clientX+n.scrollLeft,y:e.pageY||e.clientY+n.scrollTop};return r},stop:function(e){if(e.stopPropagation)e.stopPropagation();e.cancelBubble=true;if(e.preventDefault)e.preventDefault();else e.returnValue=false}};$jit.util=$jit.id=e;var t=function(n){n=n||{};var r=function(){for(var n in this){if(typeof this[n]!="function")this[n]=e.unlink(this[n])}this.constructor=r;if(t.prototyping)return this;var i=this.initialize?this.initialize.apply(this,arguments):this;this.$$family="class";return i};for(var i in t.Mutators){if(!n[i])continue;n=t.Mutators[i](n,n[i]);delete n[i]}e.extend(r,this);r.constructor=t;r.prototype=n;return r};t.Mutators={Implements:function(n,r){e.each(e.splat(r),function(e){t.prototyping=e;var r=typeof e=="function"?new e:e;for(var i in r){if(!(i in n)){n[i]=r[i]}}delete t.prototyping});return n}};e.extend(t,{inherit:function(n,r){for(var i in r){var s=r[i];var o=n[i];var u=e.type(s);if(o&&u=="function"){if(s!=o){t.override(n,i,s)}}else if(u=="object"){n[i]=e.merge(o,s)}else{n[i]=s}}return n},override:function(e,n,r){var i=t.prototyping;if(i&&e[n]!=i[n])i=null;var s=function(){var t=this.parent;this.parent=i?i[n]:e[n];var s=r.apply(this,arguments);this.parent=t;return s};e[n]=s}});t.prototype.implement=function(){var n=this.prototype;e.each(Array.prototype.slice.call(arguments||[]),function(e){t.inherit(n,e)});return this};$jit.Class=t;$jit.json={prune:function(e,t){this.each(e,function(e,n){if(n==t&&e.children){delete e.children;e.children=[]}})},getParent:function(e,t){if(e.id==t)return false;var n=e.children;if(n&&n.length>0){for(var r=0;r<n.length;r++){if(n[r].id==t)return e;else{var i=this.getParent(n[r],t);if(i)return i}}}return false},getSubtree:function(e,t){if(e.id==t)return e;for(var n=0,r=e.children;r&&n<r.length;n++){var i=this.getSubtree(r[n],t);if(i!=null)return i}return null},eachLevel:function(e,t,n,r){if(t<=n){r(e,t);if(!e.children)return;for(var i=0,s=e.children;i<s.length;i++){this.eachLevel(s[i],t+1,n,r)}}},each:function(e,t){this.eachLevel(e,0,Number.MAX_VALUE,t)}};$jit.Trans={$extend:true,linear:function(e){return e}};var n=$jit.Trans;(function(){var t=function(t,n){n=e.splat(n);return e.extend(t,{easeIn:function(e){return t(e,n)},easeOut:function(e){return 1-t(1-e,n)},easeInOut:function(e){return e<=.5?t(2*e,n)/2:(2-t(2*(1-e),n))/2}})};var r={Pow:function(e,t){return Math.pow(e,t[0]||6)},Expo:function(e){return Math.pow(2,8*(e-1))},Circ:function(e){return 1-Math.sin(Math.acos(e))},Sine:function(e){return 1-Math.sin((1-e)*Math.PI/2)},Back:function(e,t){t=t[0]||1.618;return Math.pow(e,2)*((t+1)*e-t)},Bounce:function(e){var t;for(var n=0,r=1;1;n+=r,r/=2){if(e>=(7-4*n)/11){t=r*r-Math.pow((11-6*n-11*e)/4,2);break}}return t},Elastic:function(e,t){return Math.pow(2,10*--e)*Math.cos(20*e*Math.PI*(t[0]||1)/3)}};e.each(r,function(e,r){n[r]=t(e)});e.each(["Quad","Cubic","Quart","Quint"],function(e,r){n[e]=t(function(e){return Math.pow(e,[r+2])})})})();var r=new t({initialize:function(e){this.setOptions(e)},setOptions:function(t){var r={duration:2500,fps:40,transition:n.Quart.easeInOut,compute:e.empty,complete:e.empty,link:"ignore"};this.opt=e.merge(r,t||{});return this},step:function(){var t=e.time(),n=this.opt;if(t<this.time+n.duration){var r=n.transition((t-this.time)/n.duration);n.compute(r)}else{this.timer=clearInterval(this.timer);n.compute(1);n.complete()}},start:function(){if(!this.check())return this;this.time=0;this.startTimer();return this},startTimer:function(){var t=this,n=this.opt.fps;if(this.timer)return false;this.time=e.time()-this.time;this.timer=setInterval(function(){t.step()},Math.round(1e3/n));return true},pause:function(){this.stopTimer();return this},resume:function(){this.startTimer();return this},stopTimer:function(){if(!this.timer)return false;this.time=e.time()-this.time;this.timer=clearInterval(this.timer);return true},check:function(){if(!this.timer)return true;if(this.opt.link=="cancel"){this.stopTimer();return true}return false}});var i=function(){var t=arguments;for(var n=0,r=t.length,s={};n<r;n++){var o=i[t[n]];if(o.$extend){e.extend(s,o)}else{s[t[n]]=o}}return s};i.Canvas={$extend:true,injectInto:"id",type:"2D",width:false,height:false,useCanvas:false,withLabels:true,background:false,Scene:{Lighting:{enable:false,ambient:[1,1,1],directional:{direction:{x:-100,y:-100,z:-100},color:[.5,.3,.1]}}}};i.Tree={$extend:true,orientation:"left",subtreeOffset:8,siblingOffset:5,indent:10,multitree:false,align:"center"};i.Node={$extend:false,overridable:false,type:"circle",color:"#ccb",alpha:1,dim:3,height:20,width:90,autoHeight:false,autoWidth:false,lineWidth:1,transform:true,align:"center",angularWidth:1,span:1,CanvasStyles:{}};i.Edge={$extend:false,overridable:false,type:"line",color:"#ccb",lineWidth:1,dim:15,alpha:1,epsilon:7,CanvasStyles:{}};i.Fx={$extend:true,fps:40,duration:2500,transition:$jit.Trans.Quart.easeInOut,clearCanvas:true};i.Label={$extend:false,overridable:false,type:"HTML",style:" ",size:10,family:"sans-serif",textAlign:"center",textBaseline:"alphabetic",color:"#fff"};i.Tips={$extend:false,enable:false,type:"auto",offsetX:20,offsetY:20,force:false,onShow:e.empty,onHide:e.empty};i.NodeStyles={$extend:false,enable:false,type:"auto",stylesHover:false,stylesClick:false};i.Events={$extend:false,enable:false,enableForEdges:false,type:"auto",onClick:e.empty,onRightClick:e.empty,onMouseMove:e.empty,onMouseEnter:e.empty,onMouseLeave:e.empty,onDragStart:e.empty,onDragMove:e.empty,onDragCancel:e.empty,onDragEnd:e.empty,onTouchStart:e.empty,onTouchMove:e.empty,onTouchEnd:e.empty,onMouseWheel:e.empty};i.Navigation={$extend:false,enable:false,type:"auto",panning:false,zooming:false};i.Controller={$extend:true,onBeforeCompute:e.empty,onAfterCompute:e.empty,onCreateLabel:e.empty,onPlaceLabel:e.empty,onComplete:e.empty,onBeforePlotLine:e.empty,onAfterPlotLine:e.empty,onBeforePlotNode:e.empty,onAfterPlotNode:e.empty,request:false};var s={initialize:function(e,t){this.viz=t;this.canvas=t.canvas;this.config=t.config[e];this.nodeTypes=t.fx.nodeTypes;var n=this.config.type;this.dom=n=="auto"?t.config.Label.type!="Native":n!="Native";this.labelContainer=this.dom&&t.labels.getLabelContainer();this.isEnabled()&&this.initializePost()},initializePost:e.empty,setAsProperty:e.lambda(false),isEnabled:function(){return this.config.enable},isLabel:function(t,n,r){t=e.event.get(t,n);var i=this.labelContainer,s=t.target||t.srcElement,o=t.relatedTarget;if(r){return o&&o==this.viz.canvas.getCtx().canvas&&!!s&&this.isDescendantOf(s,i)}else{return this.isDescendantOf(s,i)}},isDescendantOf:function(e,t){while(e&&e.parentNode){if(e.parentNode==t)return e;e=e.parentNode}return false}};var o={onMouseUp:e.empty,onMouseDown:e.empty,onMouseMove:e.empty,onMouseOver:e.empty,onMouseOut:e.empty,onMouseWheel:e.empty,onTouchStart:e.empty,onTouchMove:e.empty,onTouchEnd:e.empty,onTouchCancel:e.empty};var u=new t({initialize:function(e){this.viz=e;this.canvas=e.canvas;this.node=false;this.edge=false;this.registeredObjects=[];this.attachEvents()},attachEvents:function(){var t=this.canvas.getElement(),n=this;t.oncontextmenu=e.lambda(false);e.addEvents(t,{mouseup:function(t,r){var i=e.event.get(t,r);n.handleEvent("MouseUp",t,r,n.makeEventObject(t,r),e.event.isRightClick(i))},mousedown:function(t,r){var i=e.event.get(t,r);n.handleEvent("MouseDown",t,r,n.makeEventObject(t,r),e.event.isRightClick(i))},mousemove:function(e,t){n.handleEvent("MouseMove",e,t,n.makeEventObject(e,t))},mouseover:function(e,t){n.handleEvent("MouseOver",e,t,n.makeEventObject(e,t))},mouseout:function(e,t){n.handleEvent("MouseOut",e,t,n.makeEventObject(e,t))},touchstart:function(e,t){n.handleEvent("TouchStart",e,t,n.makeEventObject(e,t))},touchmove:function(e,t){n.handleEvent("TouchMove",e,t,n.makeEventObject(e,t))},touchend:function(e,t){n.handleEvent("TouchEnd",e,t,n.makeEventObject(e,t))}});var r=function(t,r){var i=e.event.get(t,r);var s=e.event.getWheel(i);n.handleEvent("MouseWheel",t,r,s)};if(!document.getBoxObjectFor&&window.mozInnerScreenX==null){e.addEvent(t,"mousewheel",r)}else{t.addEventListener("DOMMouseScroll",r,false)}},register:function(e){this.registeredObjects.push(e)},handleEvent:function(){var e=Array.prototype.slice.call(arguments),t=e.shift();for(var n=0,r=this.registeredObjects,i=r.length;n<i;n++){r[n]["on"+t].apply(r[n],e)}},makeEventObject:function(t,n){var r=this,i=this.viz.graph,s=this.viz.fx,o=s.nodeTypes,u=s.edgeTypes;return{pos:false,node:false,edge:false,contains:false,getNodeCalled:false,getEdgeCalled:false,getPos:function(){var i=r.viz.canvas,s=i.getSize(),o=i.getPos(),u=i.translateOffsetX,a=i.translateOffsetY,f=i.scaleOffsetX,l=i.scaleOffsetY,c=e.event.getPos(t,n);this.pos={x:(c.x-o.x-s.width/2-u)*1/f,y:(c.y-o.y-s.height/2-a)*1/l};return this.pos},getNode:function(){if(this.getNodeCalled)return this.node;this.getNodeCalled=true;for(var e in i.nodes){var t=i.nodes[e],n=t&&o[t.getData("type")],u=n&&n.contains&&n.contains.call(s,t,this.getPos());if(u){this.contains=u;return r.node=this.node=t}}return r.node=this.node=false},getEdge:function(){if(this.getEdgeCalled)return this.edge;this.getEdgeCalled=true;var e={};for(var t in i.edges){var n=i.edges[t];e[t]=true;for(var o in n){if(o in e)continue;var a=n[o],f=a&&u[a.getData("type")],l=f&&f.contains&&f.contains.call(s,a,this.getPos());if(l){this.contains=l;return r.edge=this.edge=a}}}return r.edge=this.edge=false},getContains:function(){if(this.getNodeCalled)return this.contains;this.getNode();return this.contains}}}});var a={initializeExtras:function(){var t=new u(this),n=this;e.each(["NodeStyles","Tips","Navigation","Events"],function(e){var r=new a.Classes[e](e,n);if(r.isEnabled()){t.register(r)}if(r.setAsProperty()){n[e.toLowerCase()]=r}})}};a.Classes={};a.Classes.Events=new t({Implements:[s,o],initializePost:function(){this.fx=this.viz.fx;this.ntypes=this.viz.fx.nodeTypes;this.etypes=this.viz.fx.edgeTypes;this.hovered=false;this.pressed=false;this.touched=false;this.touchMoved=false;this.moved=false},setAsProperty:e.lambda(true),onMouseUp:function(t,n,r,i){var s=e.event.get(t,n);if(!this.moved){if(i){this.config.onRightClick(this.hovered,r,s)}else{this.config.onClick(this.pressed,r,s)}}if(this.pressed){if(this.moved){this.config.onDragEnd(this.pressed,r,s)}else{this.config.onDragCancel(this.pressed,r,s)}this.pressed=this.moved=false}},onMouseOut:function(t,n,r){var i=e.event.get(t,n),s;if(this.dom&&(s=this.isLabel(t,n,true))){this.config.onMouseLeave(this.viz.graph.getNode(s.id),r,i);this.hovered=false;return}var o=i.relatedTarget,u=this.canvas.getElement();while(o&&o.parentNode){if(u==o.parentNode)return;o=o.parentNode}if(this.hovered){this.config.onMouseLeave(this.hovered,r,i);this.hovered=false}},onMouseOver:function(t,n,r){var i=e.event.get(t,n),s;if(this.dom&&(s=this.isLabel(t,n,true))){this.hovered=this.viz.graph.getNode(s.id);this.config.onMouseEnter(this.hovered,r,i)}},onMouseMove:function(t,n,r){var i,s=e.event.get(t,n);if(this.pressed){this.moved=true;this.config.onDragMove(this.pressed,r,s);return}if(this.dom){this.config.onMouseMove(this.hovered,r,s)}else{if(this.hovered){var o=this.hovered;var u=o.nodeFrom?this.etypes[o.getData("type")]:this.ntypes[o.getData("type")];var a=u&&u.contains&&u.contains.call(this.fx,o,r.getPos());if(a){this.config.onMouseMove(o,r,s);return}else{this.config.onMouseLeave(o,r,s);this.hovered=false}}if(this.hovered=r.getNode()||this.config.enableForEdges&&r.getEdge()){this.config.onMouseEnter(this.hovered,r,s)}else{this.config.onMouseMove(false,r,s)}}},onMouseWheel:function(t,n,r){this.config.onMouseWheel(r,e.event.get(t,n))},onMouseDown:function(t,n,r){var i=e.event.get(t,n),s;if(this.dom){if(s=this.isLabel(t,n)){this.pressed=this.viz.graph.getNode(s.id)}}else{this.pressed=r.getNode()||this.config.enableForEdges&&r.getEdge()}this.pressed&&this.config.onDragStart(this.pressed,r,i)},onTouchStart:function(t,n,r){var i=e.event.get(t,n),s;if(this.dom&&(s=this.isLabel(t,n))){this.touched=this.viz.graph.getNode(s.id)}else{this.touched=r.getNode()||this.config.enableForEdges&&r.getEdge()}this.touched&&this.config.onTouchStart(this.touched,r,i)},onTouchMove:function(t,n,r){var i=e.event.get(t,n);if(this.touched){this.touchMoved=true;this.config.onTouchMove(this.touched,r,i)}},onTouchEnd:function(t,n,r){var i=e.event.get(t,n);if(this.touched){if(this.touchMoved){this.config.onTouchEnd(this.touched,r,i)}else{this.config.onTouchCancel(this.touched,r,i)}this.touched=this.touchMoved=false}}});a.Classes.Tips=new t({Implements:[s,o],initializePost:function(){if(document.body){var t=e("_tooltip")||document.createElement("div");t.id="_tooltip";t.className="tip";e.extend(t.style,{position:"absolute",display:"none",zIndex:13e3});document.body.appendChild(t);this.tip=t;this.node=false}},setAsProperty:e.lambda(true),onMouseOut:function(t,n){var r=e.event.get(t,n);if(this.dom&&this.isLabel(t,n,true)){this.hide(true);return}var i=t.relatedTarget,s=this.canvas.getElement();while(i&&i.parentNode){if(s==i.parentNode)return;i=i.parentNode}this.hide(false)},onMouseOver:function(e,t){var n;if(this.dom&&(n=this.isLabel(e,t,false))){this.node=this.viz.graph.getNode(n.id);this.config.onShow(this.tip,this.node,n)}},onMouseMove:function(t,n,r){if(this.dom&&this.isLabel(t,n)){this.setTooltipPosition(e.event.getPos(t,n))}if(!this.dom){var i=r.getNode();if(!i){this.hide(true);return}if(this.config.force||!this.node||this.node.id!=i.id){this.node=i;this.config.onShow(this.tip,i,r.getContains())}this.setTooltipPosition(e.event.getPos(t,n))}},setTooltipPosition:function(e){var t=this.tip,n=t.style,r=this.config;n.display="";var i={height:document.body.clientHeight,width:document.body.clientWidth};var s={width:t.offsetWidth,height:t.offsetHeight};var o=r.offsetX,u=r.offsetY;n.top=(e.y+u+s.height>i.height?e.y-s.height-u:e.y+u)+"px";n.left=(e.x+s.width+o>i.width?e.x-s.width-o:e.x+o)+"px"},hide:function(e){this.tip.style.display="none";e&&this.config.onHide()}});a.Classes.NodeStyles=new t({Implements:[s,o],initializePost:function(){this.fx=this.viz.fx;this.types=this.viz.fx.nodeTypes;this.nStyles=this.config;this.nodeStylesOnHover=this.nStyles.stylesHover;this.nodeStylesOnClick=this.nStyles.stylesClick;this.hoveredNode=false;this.fx.nodeFxAnimation=new r;this.down=false;this.move=false},onMouseOut:function(e,t){this.down=this.move=false;if(!this.hoveredNode)return;if(this.dom&&this.isLabel(e,t,true)){this.toggleStylesOnHover(this.hoveredNode,false)}var n=e.relatedTarget,r=this.canvas.getElement();while(n&&n.parentNode){if(r==n.parentNode)return;n=n.parentNode}this.toggleStylesOnHover(this.hoveredNode,false);this.hoveredNode=false},onMouseOver:function(e,t){var n;if(this.dom&&(n=this.isLabel(e,t,true))){var r=this.viz.graph.getNode(n.id);if(r.selected)return;this.hoveredNode=r;this.toggleStylesOnHover(this.hoveredNode,true)}},onMouseDown:function(e,t,n,r){if(r)return;var i;if(this.dom&&(i=this.isLabel(e,t))){this.down=this.viz.graph.getNode(i.id)}else if(!this.dom){this.down=n.getNode()}this.move=false},onMouseUp:function(e,t,n,r){if(r)return;if(!this.move){this.onClick(n.getNode())}this.down=this.move=false},getRestoredStyles:function(e,t){var n={},r=this["nodeStylesOn"+t];for(var i in r){n[i]=e.styles["$"+i]}return n},toggleStylesOnHover:function(e,t){if(this.nodeStylesOnHover){this.toggleStylesOn("Hover",e,t)}},toggleStylesOnClick:function(e,t){if(this.nodeStylesOnClick){this.toggleStylesOn("Click",e,t)}},toggleStylesOn:function(t,r,i){var s=this.viz;var o=this.nStyles;if(i){var u=this;if(!r.styles){r.styles=e.merge(r.data,{})}for(var a in this["nodeStylesOn"+t]){var f="$"+a;if(!(f in r.styles)){r.styles[f]=r.getData(a)}}s.fx.nodeFx(e.extend({elements:{id:r.id,properties:u["nodeStylesOn"+t]},transition:n.Quart.easeOut,duration:300,fps:40},this.config))}else{var l=this.getRestoredStyles(r,t);s.fx.nodeFx(e.extend({elements:{id:r.id,properties:l},transition:n.Quart.easeOut,duration:300,fps:40},this.config))}},onClick:function(e){if(!e)return;var t=this.nodeStylesOnClick;if(!t)return;if(e.selected){this.toggleStylesOnClick(e,false);delete e.selected}else{this.viz.graph.eachNode(function(e){if(e.selected){for(var n in t){e.setData(n,e.styles["$"+n],"end")}delete e.selected}});this.toggleStylesOnClick(e,true);e.selected=true;delete e.hovered;this.hoveredNode=false}},onMouseMove:function(e,t,n){if(this.down)this.move=true;if(this.dom&&this.isLabel(e,t))return;var r=this.nodeStylesOnHover;if(!r)return;if(!this.dom){if(this.hoveredNode){var i=this.types[this.hoveredNode.getData("type")];var s=i&&i.contains&&i.contains.call(this.fx,this.hoveredNode,n.getPos());if(s)return}var o=n.getNode();if(!this.hoveredNode&&!o)return;if(o.hovered)return;if(o&&!o.selected){this.fx.nodeFxAnimation.stopTimer();this.viz.graph.eachNode(function(e){if(e.hovered&&!e.selected){for(var t in r){e.setData(t,e.styles["$"+t],"end")}delete e.hovered}});o.hovered=true;this.hoveredNode=o;this.toggleStylesOnHover(o,true)}else if(this.hoveredNode&&!this.hoveredNode.selected){this.fx.nodeFxAnimation.stopTimer();this.toggleStylesOnHover(this.hoveredNode,false);delete this.hoveredNode.hovered;this.hoveredNode=false}}}});a.Classes.Navigation=new t({Implements:[s,o],initializePost:function(){this.pos=false;this.pressed=false},onMouseWheel:function(t,n,r){if(!this.config.zooming)return;e.event.stop(e.event.get(t,n));var i=this.config.zooming/1e3,s=1+r*i;this.canvas.scale(s,s)},onMouseDown:function(e,t,n){if(!this.config.panning)return;if(this.config.panning=="avoid nodes"&&(this.dom?this.isLabel(e,t):n.getNode()))return;this.pressed=true;this.pos=n.getPos();var r=this.canvas,i=r.translateOffsetX,s=r.translateOffsetY,o=r.scaleOffsetX,u=r.scaleOffsetY;this.pos.x*=o;this.pos.x+=i;this.pos.y*=u;this.pos.y+=s},onMouseMove:function(e,t,n){if(!this.config.panning)return;if(!this.pressed)return;if(this.config.panning=="avoid nodes"&&(this.dom?this.isLabel(e,t):n.getNode()))return;var r=this.pos,i=n.getPos(),s=this.canvas,o=s.translateOffsetX,u=s.translateOffsetY,a=s.scaleOffsetX,f=s.scaleOffsetY;i.x*=a;i.y*=f;i.x+=o;i.y+=u;var l=i.x-r.x,c=i.y-r.y;this.pos=i;this.canvas.translate(l*1/a,c*1/f)},onMouseUp:function(e,t,n,r){if(!this.config.panning)return;this.pressed=false}});var f;(function(){function i(t,n){var i=document.createElement(t);for(var s in n){if(typeof n[s]=="object"){e.extend(i[s],n[s])}else{i[s]=n[s]}}if(t=="canvas"&&!r&&G_vmlCanvasManager){i=G_vmlCanvasManager.initElement(document.body.appendChild(i))}return i}var n=typeof HTMLCanvasElement,r=n=="object"||n=="function";$jit.Canvas=f=new t({canvases:[],pos:false,element:false,labelContainer:false,translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(t,n){this.viz=t;this.opt=this.config=n;var r=e.type(n.injectInto)=="string"?n.injectInto:n.injectInto.id,s=n.type,o=r+"-label",u=e(r),a=n.width||u.offsetWidth,l=n.height||u.offsetHeight;this.id=r;var c={injectInto:r,width:a,height:l};this.element=i("div",{id:r+"-canvaswidget",style:{position:"relative",width:a+"px",height:l+"px"}});this.labelContainer=this.createLabelContainer(n.Label.type,o,c);this.canvases.push(new f.Base[s]({config:e.extend({idSuffix:"-canvas"},c),plot:function(e){t.fx.plot()},resize:function(){t.refresh()}}));var h=n.background;if(h){var p=new f.Background[h.type](t,e.extend(h,c));this.canvases.push(new f.Base[s](p))}var d=this.canvases.length;while(d--){this.element.appendChild(this.canvases[d].canvas);if(d>0){this.canvases[d].plot()}}this.element.appendChild(this.labelContainer);u.appendChild(this.element);var v=null,m=this;e.addEvent(window,"scroll",function(){clearTimeout(v);v=setTimeout(function(){m.getPos(true)},500)})},getCtx:function(e){return this.canvases[e||0].getCtx()},getConfig:function(){return this.opt},getElement:function(){return this.element},getSize:function(e){return this.canvases[e||0].getSize()},resize:function(e,t){this.getPos(true);this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;for(var n=0,r=this.canvases.length;n<r;n++){this.canvases[n].resize(e,t)}var i=this.element.style;i.width=e+"px";i.height=t+"px";if(this.labelContainer)this.labelContainer.style.width=e+"px"},translate:function(e,t,n){this.translateOffsetX+=e*this.scaleOffsetX;this.translateOffsetY+=t*this.scaleOffsetY;for(var r=0,i=this.canvases.length;r<i;r++){this.canvases[r].translate(e,t,n)}},scale:function(e,t,n){var r=this.scaleOffsetX*e,i=this.scaleOffsetY*t;var s=this.translateOffsetX*(e-1)/r,o=this.translateOffsetY*(t-1)/i;this.scaleOffsetX=r;this.scaleOffsetY=i;for(var u=0,a=this.canvases.length;u<a;u++){this.canvases[u].scale(e,t,true)}this.translate(s,o,false)},getPos:function(t){if(t||!this.pos){return this.pos=e.getPos(this.getElement())}return this.pos},clear:function(e){this.canvases[e||0].clear()},path:function(e,t){var n=this.canvases[0].getCtx();n.beginPath();t(n);n[e]();n.closePath()},createLabelContainer:function(e,t,n){var r="http://www.w3.org/2000/svg";if(e=="HTML"||e=="Native"){return i("div",{id:t,style:{overflow:"visible",position:"absolute",top:0,left:0,width:n.width+"px",height:0}})}else if(e=="SVG"){var s=document.createElementNS(r,"svg:svg");s.setAttribute("width",n.width);s.setAttribute("height",n.height);var o=s.style;o.position="absolute";o.left=o.top="0px";var u=document.createElementNS(r,"svg:g");u.setAttribute("width",n.width);u.setAttribute("height",n.height);u.setAttribute("x",0);u.setAttribute("y",0);u.setAttribute("id",t);s.appendChild(u);return s}}});f.Base={};f.Base["2D"]=new t({translateOffsetX:0,translateOffsetY:0,scaleOffsetX:1,scaleOffsetY:1,initialize:function(e){this.viz=e;this.opt=e.config;this.size=false;this.createCanvas();this.translateToCenter()},createCanvas:function(){var e=this.opt,t=e.width,n=e.height;this.canvas=i("canvas",{id:e.injectInto+e.idSuffix,width:t,height:n,style:{position:"absolute",top:0,left:0,width:t+"px",height:n+"px"}})},getCtx:function(){if(!this.ctx)return this.ctx=this.canvas.getContext("2d");return this.ctx},getSize:function(){if(this.size)return this.size;var e=this.canvas;return this.size={width:e.width,height:e.height}},translateToCenter:function(e){var t=this.getSize(),n=e?t.width-e.width-this.translateOffsetX*2:t.width;height=e?t.height-e.height-this.translateOffsetY*2:t.height;var r=this.getCtx();e&&r.scale(1/this.scaleOffsetX,1/this.scaleOffsetY);r.translate(n/2,height/2)},resize:function(e,t){var n=this.getSize(),i=this.canvas,s=i.style;this.size=false;i.width=e;i.height=t;s.width=e+"px";s.height=t+"px";if(!r){this.translateToCenter(n)}else{this.translateToCenter()}this.translateOffsetX=this.translateOffsetY=0;this.scaleOffsetX=this.scaleOffsetY=1;this.clear();this.viz.resize(e,t,this)},translate:function(e,t,n){var r=this.scaleOffsetX,i=this.scaleOffsetY;this.translateOffsetX+=e*r;this.translateOffsetY+=t*i;this.getCtx().translate(e,t);!n&&this.plot()},scale:function(e,t,n){this.scaleOffsetX*=e;this.scaleOffsetY*=t;this.getCtx().scale(e,t);!n&&this.plot()},clear:function(){var e=this.getSize(),t=this.translateOffsetX,n=this.translateOffsetY,r=this.scaleOffsetX,i=this.scaleOffsetY;this.getCtx().clearRect((-e.width/2-t)*1/r,(-e.height/2-n)*1/i,e.width*1/r,e.height*1/i)},plot:function(){this.clear();this.viz.plot(this)}});f.Background={};f.Background.Circles=new t({initialize:function(t,n){this.viz=t;this.config=e.merge({idSuffix:"-bkcanvas",levelDistance:100,numberOfCircles:6,CanvasStyles:{},offset:0},n)},resize:function(e,t,n){this.plot(n)},plot:function(e){var t=e.canvas,n=e.getCtx(),r=this.config,i=r.CanvasStyles;for(var s in i)n[s]=i[s];var o=r.numberOfCircles,u=r.levelDistance;for(var a=1;a<=o;a++){n.beginPath();n.arc(0,0,u*a,0,2*Math.PI,false);n.stroke();n.closePath()}}})})();var l=function(e,t){this.theta=e||0;this.rho=t||0};$jit.Polar=l;l.prototype={getc:function(e){return this.toComplex(e)},getp:function(){return this},set:function(e){e=e.getp();this.theta=e.theta;this.rho=e.rho},setc:function(e,t){this.rho=Math.sqrt(e*e+t*t);this.theta=Math.atan2(t,e);if(this.theta<0)this.theta+=Math.PI*2},setp:function(e,t){this.theta=e;this.rho=t},clone:function(){return new l(this.theta,this.rho)},toComplex:function(e){var t=Math.cos(this.theta)*this.rho;var n=Math.sin(this.theta)*this.rho;if(e)return{x:t,y:n};return new h(t,n)},add:function(e){return new l(this.theta+e.theta,this.rho+e.rho)},scale:function(e){return new l(this.theta,this.rho*e)},equals:function(e){return this.theta==e.theta&&this.rho==e.rho},$add:function(e){this.theta=this.theta+e.theta;this.rho+=e.rho;return this},$madd:function(e){this.theta=(this.theta+e.theta)%(Math.PI*2);this.rho+=e.rho;return this},$scale:function(e){this.rho*=e;return this},isZero:function(){var e=1e-4,t=Math.abs;return t(this.theta)<e&&t(this.rho)<e},interpolate:function(e,t){var n=Math.PI,r=n*2;var i=function(e){var t=e<0?e%r+r:e%r;return t};var s=this.theta,o=e.theta;var u,a=Math.abs(s-o);if(a==n){if(s>o){u=i(o+(s-r-o)*t)}else{u=i(o-r+(s-o)*t)}}else if(a>=n){if(s>o){u=i(o+(s-r-o)*t)}else{u=i(o-r+(s-(o-r))*t)}}else{u=i(o+(s-o)*t)}var f=(this.rho-e.rho)*t+e.rho;return{theta:u,rho:f}}};var c=function(e,t){return new l(e,t)};l.KER=c(0,0);var h=function(e,t){this.x=e||0;this.y=t||0};$jit.Complex=h;h.prototype={getc:function(){return this},getp:function(e){return this.toPolar(e)},set:function(e){e=e.getc(true);this.x=e.x;this.y=e.y},setc:function(e,t){this.x=e;this.y=t},setp:function(e,t){this.x=Math.cos(e)*t;this.y=Math.sin(e)*t},clone:function(){return new h(this.x,this.y)},toPolar:function(e){var t=this.norm();var n=Math.atan2(this.y,this.x);if(n<0)n+=Math.PI*2;if(e)return{theta:n,rho:t};return new l(n,t)},norm:function(){return Math.sqrt(this.squaredNorm())},squaredNorm:function(){return this.x*this.x+this.y*this.y},add:function(e){return new h(this.x+e.x,this.y+e.y)},prod:function(e){return new h(this.x*e.x-this.y*e.y,this.y*e.x+this.x*e.y)},conjugate:function(){return new h(this.x,-this.y)},scale:function(e){return new h(this.x*e,this.y*e)},equals:function(e){return this.x==e.x&&this.y==e.y},$add:function(e){this.x+=e.x;this.y+=e.y;return this},$prod:function(e){var t=this.x,n=this.y;this.x=t*e.x-n*e.y;this.y=n*e.x+t*e.y;return this},$conjugate:function(){this.y=-this.y;return this},$scale:function(e){this.x*=e;this.y*=e;return this},$div:function(e){var t=this.x,n=this.y;var r=e.squaredNorm();this.x=t*e.x+n*e.y;this.y=n*e.x-t*e.y;return this.$scale(1/r)},isZero:function(){var e=1e-4,t=Math.abs;return t(this.x)<e&&t(this.y)<e}};var p=function(e,t){return new h(e,t)};h.KER=p(0,0);$jit.Graph=new t({initialize:function(t,n,r,i){var s={klass:h,Node:{}};this.Node=n;this.Edge=r;this.Label=i;this.opt=e.merge(s,t||{});this.nodes={};this.edges={};var o=this;this.nodeList={};for(var u in v){o.nodeList[u]=function(e){return function(){var t=Array.prototype.slice.call(arguments);o.eachNode(function(n){n[e].apply(n,t)})}}(u)}},getNode:function(e){if(this.hasNode(e))return this.nodes[e];return false},get:function(e){return this.getNode(e)},getByName:function(e){for(var t in this.nodes){var n=this.nodes[t];if(n.name==e)return n}return false},getAdjacence:function(e,t){if(e in this.edges){return this.edges[e][t]}return false},addNode:function(t){if(!this.nodes[t.id]){var n=this.edges[t.id]={};this.nodes[t.id]=new d.Node(e.extend({id:t.id,name:t.name,data:e.merge(t.data||{},{}),adjacencies:n},this.opt.Node),this.opt.klass,this.Node,this.Edge,this.Label)}return this.nodes[t.id]},addAdjacence:function(e,t,n){if(!this.hasNode(e.id)){this.addNode(e)}if(!this.hasNode(t.id)){this.addNode(t)}e=this.nodes[e.id];t=this.nodes[t.id];if(!e.adjacentTo(t)){var r=this.edges[e.id]=this.edges[e.id]||{};var i=this.edges[t.id]=this.edges[t.id]||{};r[t.id]=i[e.id]=new d.Adjacence(e,t,n,this.Edge,this.Label);return r[t.id]}return this.edges[e.id][t.id]},removeNode:function(e){if(this.hasNode(e)){delete this.nodes[e];var t=this.edges[e];for(var n in t){delete this.edges[n][e]}delete this.edges[e]}},removeAdjacence:function(e,t){delete this.edges[e][t];delete this.edges[t][e]},hasNode:function(e){return e in this.nodes},empty:function(){this.nodes={};this.edges={}}});var d=$jit.Graph;var v;(function(){var t=function(e,t,n,r,i){var s;n=n||"current";e="$"+(e?e+"-":"");if(n=="current"){s=this.data}else if(n=="start"){s=this.startData}else if(n=="end"){s=this.endData}var o=e+t;if(r){return s[o]}if(!this.Config.overridable)return i[t]||0;return o in s?s[o]:o in this.data?this.data[o]:i[t]||0};var n=function(e,t,n,r){r=r||"current";e="$"+(e?e+"-":"");var i;if(r=="current"){i=this.data}else if(r=="start"){i=this.startData}else if(r=="end"){i=this.endData}i[e+t]=n};var r=function(t,n){t="$"+(t?t+"-":"");var r=this;e.each(n,function(e){var n=t+e;delete r.data[n];delete r.endData[n];delete r.startData[n]})};v={getData:function(e,n,r){return t.call(this,"",e,n,r,this.Config)},setData:function(e,t,r){n.call(this,"",e,t,r)},setDataset:function(t,n){t=e.splat(t);for(var r in n){for(var i=0,s=e.splat(n[r]),o=t.length;i<o;i++){this.setData(r,s[i],t[i])}}},removeData:function(){r.call(this,"",Array.prototype.slice.call(arguments))},getCanvasStyle:function(e,n,r){return t.call(this,"canvas",e,n,r,this.Config.CanvasStyles)},setCanvasStyle:function(e,t,r){n.call(this,"canvas",e,t,r)},setCanvasStyles:function(t,n){t=e.splat(t);for(var r in n){for(var i=0,s=e.splat(n[r]),o=t.length;i<o;i++){this.setCanvasStyle(r,s[i],t[i])}}},removeCanvasStyle:function(){r.call(this,"canvas",Array.prototype.slice.call(arguments))},getLabelData:function(e,n,r){return t.call(this,"label",e,n,r,this.Label)},setLabelData:function(e,t,r){n.call(this,"label",e,t,r)},setLabelDataset:function(t,n){t=e.splat(t);for(var r in n){for(var i=0,s=e.splat(n[r]),o=t.length;i<o;i++){this.setLabelData(r,s[i],t[i])}}},removeLabelData:function(){r.call(this,"label",Array.prototype.slice.call(arguments))}}})();d.Node=new t({initialize:function(t,n,r,i,s){var o={id:"",name:"",data:{},startData:{},endData:{},adjacencies:{},selected:false,drawn:false,exist:false,angleSpan:{begin:0,end:0},pos:new n,startPos:new n,endPos:new n};e.extend(this,e.extend(o,t));this.Config=this.Node=r;this.Edge=i;this.Label=s},adjacentTo:function(e){return e.id in this.adjacencies},getAdjacency:function(e){return this.adjacencies[e]},getPos:function(e){e=e||"current";if(e=="current"){return this.pos}else if(e=="end"){return this.endPos}else if(e=="start"){return this.startPos}},setPos:function(e,t){t=t||"current";var n;if(t=="current"){n=this.pos}else if(t=="end"){n=this.endPos}else if(t=="start"){n=this.startPos}n.set(e)}});d.Node.implement(v);d.Adjacence=new t({initialize:function(e,t,n,r,i){this.nodeFrom=e;this.nodeTo=t;this.data=n||{};this.startData={};this.endData={};this.Config=this.Edge=r;this.Label=i}});d.Adjacence.implement(v);d.Util={filter:function(t){if(!t||!(e.type(t)=="string"))return function(){return true};var n=t.split(" ");return function(e){for(var t=0;t<n.length;t++){if(e[n[t]]){return false}}return true}},getNode:function(e,t){return e.nodes[t]},eachNode:function(e,t,n){var r=this.filter(n);for(var i in e.nodes){if(r(e.nodes[i]))t(e.nodes[i])}},each:function(e,t,n){this.eachNode(e,t,n)},eachAdjacency:function(e,t,n){var r=e.adjacencies,i=this.filter(n);for(var s in r){var o=r[s];if(i(o)){if(o.nodeFrom!=e){var u=o.nodeFrom;o.nodeFrom=o.nodeTo;o.nodeTo=u}t(o,s)}}},computeLevels:function(e,t,n,r){n=n||0;var i=this.filter(r);this.eachNode(e,function(e){e._flag=false;e._depth=-1},r);var s=e.getNode(t);s._depth=n;var o=[s];while(o.length!=0){var u=o.pop();u._flag=true;this.eachAdjacency(u,function(e){var t=e.nodeTo;if(t._flag==false&&i(t)){if(t._depth<0)t._depth=u._depth+1+n;o.unshift(t)}},r)}},eachBFS:function(e,t,n,r){var i=this.filter(r);this.clean(e);var s=[e.getNode(t)];while(s.length!=0){var o=s.pop();o._flag=true;n(o,o._depth);this.eachAdjacency(o,function(e){var t=e.nodeTo;if(t._flag==false&&i(t)){t._flag=true;s.unshift(t)}},r)}},eachLevel:function(e,t,n,r,i){var s=e._depth,o=this.filter(i),u=this;n=n===false?Number.MAX_VALUE-s:n;(function a(e,t,n){var i=e._depth;if(i>=t&&i<=n&&o(e))r(e,i);if(i<n){u.eachAdjacency(e,function(e){var r=e.nodeTo;if(r._depth>i)a(r,t,n)})}})(e,t+s,n+s)},eachSubgraph:function(e,t,n){this.eachLevel(e,0,false,t,n)},eachSubnode:function(e,t,n){this.eachLevel(e,1,1,t,n)},anySubnode:function(t,n,r){var i=false;n=n||e.lambda(true);var s=e.type(n)=="string"?function(e){return e[n]}:n;this.eachSubnode(t,function(e){if(s(e))i=true},r);return i},getSubnodes:function(t,n,r){var i=[],s=this;n=n||0;var o,u;if(e.type(n)=="array"){o=n[0];u=n[1]}else{o=n;u=Number.MAX_VALUE-t._depth}this.eachLevel(t,o,u,function(e){i.push(e)},r);return i},getParents:function(e){var t=[];this.eachAdjacency(e,function(n){var r=n.nodeTo;if(r._depth<e._depth)t.push(r)});return t},isDescendantOf:function(e,t){if(e.id==t)return true;var n=this.getParents(e),r=false;for(var i=0;!r&&i<n.length;i++){r=r||this.isDescendantOf(n[i],t)}return r},clean:function(e){this.eachNode(e,function(e){e._flag=false})},getClosestNodeToOrigin:function(e,t,n){return this.getClosestNodeToPos(e,l.KER,t,n)},getClosestNodeToPos:function(e,t,n,r){var i=null;n=n||"current";t=t&&t.getc(true)||h.KER;var s=function(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r};this.eachNode(e,function(e){i=i==null||s(e.getPos(n).getc(true),t)<s(i.getPos(n).getc(true),t)?e:i},r);return i}};e.each(["get","getNode","each","eachNode","computeLevels","eachBFS","clean","getClosestNodeToPos","getClosestNodeToOrigin"],function(e){d.prototype[e]=function(){return d.Util[e].apply(d.Util,[this].concat(Array.prototype.slice.call(arguments)))}});e.each(["eachAdjacency","eachLevel","eachSubgraph","eachSubnode","anySubnode","getSubnodes","getParents","isDescendantOf"],function(e){d.Node.prototype[e]=function(){return d.Util[e].apply(d.Util,[this].concat(Array.prototype.slice.call(arguments)))}});d.Op={options:{type:"nothing",duration:2e3,hideLabels:true,fps:30},initialize:function(e){this.viz=e},removeNode:function(t,n){var r=this.viz;var i=e.merge(this.options,r.controller,n);var s=e.splat(t);var o,u,a;switch(i.type){case"nothing":for(o=0;o<s.length;o++)r.graph.removeNode(s[o]);break;case"replot":this.removeNode(s,{type:"nothing"});r.labels.clearLabels();r.refresh(true);break;case"fade:seq":case"fade":u=this;for(o=0;o<s.length;o++){a=r.graph.getNode(s[o]);a.setData("alpha",0,"end")}r.fx.animate(e.merge(i,{modes:["node-property:alpha"],onComplete:function(){u.removeNode(s,{type:"nothing"});r.labels.clearLabels();r.reposition();r.fx.animate(e.merge(i,{modes:["linear"]}))}}));break;case"fade:con":u=this;for(o=0;o<s.length;o++){a=r.graph.getNode(s[o]);a.setData("alpha",0,"end");a.ignore=true}r.reposition();r.fx.animate(e.merge(i,{modes:["node-property:alpha","linear"],onComplete:function(){u.removeNode(s,{type:"nothing"});i.onComplete&&i.onComplete()}}));break;case"iter":u=this;r.fx.sequence({condition:function(){return s.length!=0},step:function(){u.removeNode(s.shift(),{type:"nothing"});r.labels.clearLabels()},onComplete:function(){i.onComplete&&i.onComplete()},duration:Math.ceil(i.duration/s.length)});break;default:this.doError()}},removeEdge:function(t,n){var r=this.viz;var i=e.merge(this.options,r.controller,n);var s=e.type(t[0])=="string"?[t]:t;var o,u,a;switch(i.type){case"nothing":for(o=0;o<s.length;o++)r.graph.removeAdjacence(s[o][0],s[o][1]);break;case"replot":this.removeEdge(s,{type:"nothing"});r.refresh(true);break;case"fade:seq":case"fade":u=this;for(o=0;o<s.length;o++){a=r.graph.getAdjacence(s[o][0],s[o][1]);if(a){a.setData("alpha",0,"end")}}r.fx.animate(e.merge(i,{modes:["edge-property:alpha"],onComplete:function(){u.removeEdge(s,{type:"nothing"});r.reposition();r.fx.animate(e.merge(i,{modes:["linear"]}))}}));break;case"fade:con":u=this;for(o=0;o<s.length;o++){a=r.graph.getAdjacence(s[o][0],s[o][1]);if(a){a.setData("alpha",0,"end");a.ignore=true}}r.reposition();r.fx.animate(e.merge(i,{modes:["edge-property:alpha","linear"],onComplete:function(){u.removeEdge(s,{type:"nothing"});i.onComplete&&i.onComplete()}}));break;case"iter":u=this;r.fx.sequence({condition:function(){return s.length!=0},step:function(){u.removeEdge(s.shift(),{type:"nothing"});r.labels.clearLabels()},onComplete:function(){i.onComplete()},duration:Math.ceil(i.duration/s.length)});break;default:this.doError()}},sum:function(t,n){var r=this.viz;var i=e.merge(this.options,r.controller,n),s=r.root;var o;r.root=n.id||r.root;switch(i.type){case"nothing":o=r.construct(t);o.eachNode(function(e){e.eachAdjacency(function(e){r.graph.addAdjacence(e.nodeFrom,e.nodeTo,e.data)})});break;case"replot":r.refresh(true);this.sum(t,{type:"nothing"});r.refresh(true);break;case"fade:seq":case"fade":case"fade:con":that=this;o=r.construct(t);var u=this.preprocessSum(o);var a=!u?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];r.reposition();if(i.type!="fade:con"){r.fx.animate(e.merge(i,{modes:["linear"],onComplete:function(){r.fx.animate(e.merge(i,{modes:a,onComplete:function(){i.onComplete()}}))}}))}else{r.graph.eachNode(function(e){if(e.id!=s&&e.pos.isZero()){e.pos.set(e.endPos);e.startPos.set(e.endPos)}});r.fx.animate(e.merge(i,{modes:["linear"].concat(a)}))}break;default:this.doError()}},morph:function(t,n,r){r=r||{};var i=this.viz;var s=e.merge(this.options,i.controller,n),o=i.root;var u;i.root=n.id||i.root;switch(s.type){case"nothing":u=i.construct(t);u.eachNode(function(e){var t=i.graph.hasNode(e.id);e.eachAdjacency(function(e){var t=!!i.graph.getAdjacence(e.nodeFrom.id,e.nodeTo.id);i.graph.addAdjacence(e.nodeFrom,e.nodeTo,e.data);if(t){var n=i.graph.getAdjacence(e.nodeFrom.id,e.nodeTo.id);for(var r in e.data||{}){n.data[r]=e.data[r]}}});if(t){var n=i.graph.getNode(e.id);for(var r in e.data||{}){n.data[r]=e.data[r]}}});i.graph.eachNode(function(e){e.eachAdjacency(function(e){if(!u.getAdjacence(e.nodeFrom.id,e.nodeTo.id)){i.graph.removeAdjacence(e.nodeFrom.id,e.nodeTo.id)}});if(!u.hasNode(e.id))i.graph.removeNode(e.id)});break;case"replot":i.labels.clearLabels(true);this.morph(t,{type:"nothing"});i.refresh(true);i.refresh(true);break;case"fade:seq":case"fade":case"fade:con":that=this;u=i.construct(t);var a="node-property"in r&&e.map(e.splat(r["node-property"]),function(e){return"$"+e});i.graph.eachNode(function(t){var n=u.getNode(t.id);if(!n){t.setData("alpha",1);t.setData("alpha",1,"start");t.setData("alpha",0,"end");t.ignore=true}else{var r=n.data;for(var i in r){if(a&&e.indexOf(a,i)>-1){t.endData[i]=r[i]}else{t.data[i]=r[i]}}}});i.graph.eachNode(function(e){if(e.ignore)return;e.eachAdjacency(function(e){if(e.nodeFrom.ignore||e.nodeTo.ignore)return;var t=u.getNode(e.nodeFrom.id);var n=u.getNode(e.nodeTo.id);if(!t.adjacentTo(n)){var e=i.graph.getAdjacence(t.id,n.id);f=true;e.setData("alpha",1);e.setData("alpha",1,"start");e.setData("alpha",0,"end")}})});var f=this.preprocessSum(u);var c=!f?["node-property:alpha"]:["node-property:alpha","edge-property:alpha"];c[0]=c[0]+("node-property"in r?":"+e.splat(r["node-property"]).join(":"):"");c[1]=(c[1]||"edge-property:alpha")+("edge-property"in r?":"+e.splat(r["edge-property"]).join(":"):"");if("label-property"in r){c.push("label-property:"+e.splat(r["label-property"]).join(":"))}if(i.reposition){i.reposition()}else{i.compute("end")}i.graph.eachNode(function(e){if(e.id!=o&&e.pos.getp().equals(l.KER)){e.pos.set(e.endPos);e.startPos.set(e.endPos)}});i.fx.animate(e.merge(s,{modes:[r.position||"polar"].concat(c),onComplete:function(){i.graph.eachNode(function(e){if(e.ignore)i.graph.removeNode(e.id)});i.graph.eachNode(function(e){e.eachAdjacency(function(e){if(e.ignore)i.graph.removeAdjacence(e.nodeFrom.id,e.nodeTo.id)})});s.onComplete()}}));break;default:}},contract:function(t,n){var r=this.viz;if(t.collapsed||!t.anySubnode(e.lambda(true)))return;n=e.merge(this.options,r.config,n||{},{modes:["node-property:alpha:span","linear"]});t.collapsed=true;(function i(e){e.eachSubnode(function(e){e.ignore=true;e.setData("alpha",0,n.type=="animate"?"end":"current");i(e)})})(t);if(n.type=="animate"){r.compute("end");if(r.rotated){r.rotate(r.rotated,"none",{property:"end"})}(function s(e){e.eachSubnode(function(e){e.setPos(t.getPos("end"),"end");s(e)})})(t);r.fx.animate(n)}else if(n.type=="replot"){r.refresh()}},expand:function(t,n){if(!("collapsed"in t))return;var r=this.viz;n=e.merge(this.options,r.config,n||{},{modes:["node-property:alpha:span","linear"]});delete t.collapsed;(function i(e){e.eachSubnode(function(e){delete e.ignore;e.setData("alpha",1,n.type=="animate"?"end":"current");i(e)})})(t);if(n.type=="animate"){r.compute("end");if(r.rotated){r.rotate(r.rotated,"none",{property:"end"})}r.fx.animate(n)}else if(n.type=="replot"){r.refresh()}},preprocessSum:function(e){var t=this.viz;e.eachNode(function(e){if(!t.graph.hasNode(e.id)){t.graph.addNode(e);var n=t.graph.getNode(e.id);n.setData("alpha",0);n.setData("alpha",0,"start");n.setData("alpha",1,"end")}});var n=false;e.eachNode(function(e){e.eachAdjacency(function(e){var r=t.graph.getNode(e.nodeFrom.id);var i=t.graph.getNode(e.nodeTo.id);if(!r.adjacentTo(i)){var e=t.graph.addAdjacence(r,i,e.data);if(r.startAlpha==r.endAlpha&&i.startAlpha==i.endAlpha){n=true;e.setData("alpha",0);e.setData("alpha",0,"start");e.setData("alpha",1,"end")}}})});return n}};var m={none:{render:e.empty,contains:e.lambda(false)},circle:{render:function(e,t,n,r){var i=r.getCtx();i.beginPath();i.arc(t.x,t.y,n,0,Math.PI*2,true);i.closePath();i[e]()},contains:function(e,t,n){var r=e.x-t.x,i=e.y-t.y,s=r*r+i*i;return s<=n*n}},ellipse:{render:function(e,t,n,r,i){var s=i.getCtx(),o=1,u=1,a=1,f=1,l=0;if(n>r){l=n/2;u=r/n;f=n/r}else{l=r/2;o=n/r;a=r/n}s.save();s.scale(o,u);s.beginPath();s.arc(t.x*a,t.y*f,l,0,Math.PI*2,true);s.closePath();s[e]();s.restore()},contains:function(e,t,n,r){var i=0,s=1,o=1,u=0,a=0,f=0;if(n>r){i=n/2;o=r/n}else{i=r/2;s=n/r}u=(e.x-t.x)*(1/s);a=(e.y-t.y)*(1/o);f=u*u+a*a;return f<=i*i}},square:{render:function(e,t,n,r){r.getCtx()[e+"Rect"](t.x-n,t.y-n,2*n,2*n)},contains:function(e,t,n){return Math.abs(t.x-e.x)<=n&&Math.abs(t.y-e.y)<=n}},rectangle:{render:function(e,t,n,r,i){i.getCtx()[e+"Rect"](t.x-n/2,t.y-r/2,n,r)},contains:function(e,t,n,r){return Math.abs(t.x-e.x)<=n/2&&Math.abs(t.y-e.y)<=r/2}},triangle:{render:function(e,t,n,r){var i=r.getCtx(),s=t.x,o=t.y-n,u=s-n,a=t.y+n,f=s+n,l=a;i.beginPath();i.moveTo(s,o);i.lineTo(u,a);i.lineTo(f,l);i.closePath();i[e]()},contains:function(e,t,n){return m.circle.contains(e,t,n)}},star:{render:function(e,t,n,r){var i=r.getCtx(),s=Math.PI/5;i.save();i.translate(t.x,t.y);i.beginPath();i.moveTo(n,0);for(var o=0;o<9;o++){i.rotate(s);if(o%2==0){i.lineTo(n/.525731*.200811,0)}else{i.lineTo(n,0)}}i.closePath();i[e]();i.restore()},contains:function(e,t,n){return m.circle.contains(e,t,n)}}};var g={line:{render:function(e,t,n){var r=n.getCtx();r.beginPath();r.moveTo(e.x,e.y);r.lineTo(t.x,t.y);r.stroke()},contains:function(e,t,n,r){var i=Math.min,s=Math.max,o=i(e.x,t.x),u=s(e.x,t.x),a=i(e.y,t.y),f=s(e.y,t.y);if(n.x>=o&&n.x<=u&&n.y>=a&&n.y<=f){if(Math.abs(t.x-e.x)<=r){return true}var l=(t.y-e.y)/(t.x-e.x)*(n.x-e.x)+e.y;return Math.abs(l-n.y)<=r}return false}},arrow:{render:function(e,t,n,r,i){var s=i.getCtx();if(r){var o=e;e=t;t=o}var u=new h(t.x-e.x,t.y-e.y);u.$scale(n/u.norm());var a=new h(t.x-u.x,t.y-u.y),f=new h(-u.y/2,u.x/2),l=a.add(f),c=a.$add(f.$scale(-1));s.beginPath();s.moveTo(e.x,e.y);s.lineTo(t.x,t.y);s.stroke();s.beginPath();s.moveTo(l.x,l.y);s.lineTo(c.x,c.y);s.lineTo(t.x,t.y);s.closePath();s.fill()},contains:function(e,t,n,r){return g.line.contains(e,t,n,r)}},hyperline:{render:function(e,t,n,r){function f(e,t){var n=e.x*t.y-e.y*t.x,r=n;var i=e.squaredNorm(),s=t.squaredNorm();if(n==0)return{x:0,y:0,ratio:-1};var o=(e.y*s-t.y*i+e.y-t.y)/n;var u=(t.x*i-e.x*s+t.x-e.x)/r;var a=-o/2;var f=-u/2;var l=(o*o+u*u)/4-1;if(l<0)return{x:0,y:0,ratio:-1};var c=Math.sqrt(l);var h={x:a,y:f,ratio:c>1e3?-1:c,a:o,b:u};return h}function a(e,t){return e<t?e+Math.PI>t?false:true:t+Math.PI>e?true:false}var i=r.getCtx();var s=f(e,t);if(s.a>1e3||s.b>1e3||s.ratio<0){i.beginPath();i.moveTo(e.x*n,e.y*n);i.lineTo(t.x*n,t.y*n);i.stroke()}else{var o=Math.atan2(t.y-s.y,t.x-s.x);var u=Math.atan2(e.y-s.y,e.x-s.x);var a=a(o,u);i.beginPath();i.arc(s.x*n,s.y*n,s.ratio*n,o,u,a);i.stroke()}},contains:e.lambda(false)}};d.Plot={initialize:function(e,t){this.viz=e;this.config=e.config;this.node=e.config.Node;this.edge=e.config.Edge;this.animation=new r;this.nodeTypes=new t.Plot.NodeTypes;this.edgeTypes=new t.Plot.EdgeTypes;this.labels=e.labels},nodeHelper:m,edgeHelper:g,Interpolator:{map:{border:"color",color:"color",width:"number",height:"number",dim:"number",alpha:"number",lineWidth:"number",angularWidth:"number",span:"number",valueArray:"array-number",dimArray:"array-number"},canvas:{globalAlpha:"number",fillStyle:"color",strokeStyle:"color",lineWidth:"number",shadowBlur:"number",shadowColor:"color",shadowOffsetX:"number",shadowOffsetY:"number",miterLimit:"number"},label:{size:"number",color:"color"},compute:function(e,t,n){return e+(t-e)*n},moebius:function(e,t,n,r){var i=r.scale(-n);if(i.norm()<1){var s=i.x,o=i.y;var u=e.startPos.getc().moebiusTransformation(i);e.pos.setc(u.x,u.y);i.x=s;i.y=o}},linear:function(e,t,n){var r=e.startPos.getc(true);var i=e.endPos.getc(true);e.pos.setc(this.compute(r.x,i.x,n),this.compute(r.y,i.y,n))},polar:function(e,t,n){var r=e.startPos.getp(true);var i=e.endPos.getp();var s=i.interpolate(r,n);e.pos.setp(s.theta,s.rho)},number:function(e,t,n,r,i){var s=e[r](t,"start");var o=e[r](t,"end");e[i](t,this.compute(s,o,n))},color:function(t,n,r,i,s){var o=e.hexToRgb(t[i](n,"start"));var u=e.hexToRgb(t[i](n,"end"));var a=this.compute;var f=e.rgbToHex([parseInt(a(o[0],u[0],r)),parseInt(a(o[1],u[1],r)),parseInt(a(o[2],u[2],r))]);t[s](n,f)},"array-number":function(e,t,n,r,i){var s=e[r](t,"start"),o=e[r](t,"end"),u=[];for(var a=0,f=s.length;a<f;a++){var l=s[a],c=o[a];if(l.length){for(var h=0,p=l.length,d=[];h<p;h++){d.push(this.compute(l[h],c[h],n))}u.push(d)}else{u.push(this.compute(l,c,n))}}e[i](t,u)},node:function(e,t,n,r,i,s){r=this[r];if(t){var o=t.length;for(var u=0;u<o;u++){var a=t[u];this[r[a]](e,a,n,i,s)}}else{for(var a in r){this[r[a]](e,a,n,i,s)}}},edge:function(e,t,n,r,i,s){var o=e.adjacencies;for(var u in o)this["node"](o[u],t,n,r,i,s)},"node-property":function(e,t,n){this["node"](e,t,n,"map","getData","setData")},"edge-property":function(e,t,n){this["edge"](e,t,n,"map","getData","setData")},"label-property":function(e,t,n){this["node"](e,t,n,"label","getLabelData","setLabelData")},"node-style":function(e,t,n){this["node"](e,t,n,"canvas","getCanvasStyle","setCanvasStyle")},"edge-style":function(e,t,n){this["edge"](e,t,n,"canvas","getCanvasStyle","setCanvasStyle")}},sequence:function(t){var n=this;t=e.merge({condition:e.lambda(false),step:e.empty,onComplete:e.empty,duration:200},t||{});var r=setInterval(function(){if(t.condition()){t.step()}else{clearInterval(r);t.onComplete()}n.viz.refresh(true)},t.duration)},prepare:function(t){var n=this.viz.graph,r={"node-property":{getter:"getData",setter:"setData"},"edge-property":{getter:"getData",setter:"setData"},"node-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"},"edge-style":{getter:"getCanvasStyle",setter:"setCanvasStyle"}};var i={};if(e.type(t)=="array"){for(var s=0,o=t.length;s<o;s++){var u=t[s].split(":");i[u.shift()]=u}}else{for(var a in t){if(a=="position"){i[t.position]=[]}else{i[a]=e.splat(t[a])}}}n.eachNode(function(t){t.startPos.set(t.pos);e.each(["node-property","node-style"],function(e){if(e in i){var n=i[e];for(var s=0,o=n.length;s<o;s++){t[r[e].setter](n[s],t[r[e].getter](n[s]),"start")}}});e.each(["edge-property","edge-style"],function(e){if(e in i){var n=i[e];t.eachAdjacency(function(t){for(var i=0,s=n.length;i<s;i++){t[r[e].setter](n[i],t[r[e].getter](n[i]),"start")}})}})});return i},animate:function(t,n){t=e.merge(this.viz.config,t||{});var r=this,i=this.viz,s=i.graph,o=this.Interpolator,u=t.type==="nodefx"?this.nodeFxAnimation:this.animation;var a=this.prepare(t.modes);if(t.hideLabels)this.labels.hideLabels(true);u.setOptions(e.extend(t,{$animating:false,compute:function(e){s.eachNode(function(t){for(var r in a){o[r](t,a[r],e,n)}});r.plot(t,this.$animating,e);this.$animating=true},complete:function(){if(t.hideLabels)r.labels.hideLabels(false);r.plot(t);t.onComplete()}})).start()},nodeFx:function(t){var n=this.viz,r=n.graph,i=this.nodeFxAnimation,s=e.merge(this.viz.config,{elements:{id:false,properties:{}},reposition:false});t=e.merge(s,t||{},{onBeforeCompute:e.empty,onAfterCompute:e.empty});i.stopTimer();var o=t.elements.properties;if(!t.elements.id){r.eachNode(function(e){for(var t in o){e.setData(t,o[t],"end")}})}else{var u=e.splat(t.elements.id);e.each(u,function(e){var t=r.getNode(e);if(t){for(var n in o){t.setData(n,o[n],"end")}}})}var a=[];for(var f in o)a.push(f);var l=["node-property:"+a.join(":")];if(t.reposition){l.push("linear");n.compute("end")}this.animate(e.merge(t,{modes:l,type:"nodefx"}))},plot:function(e,t){var n=this.viz,r=n.graph,i=n.canvas,s=n.root,o=this,u=i.getCtx(),a=Math.min,e=e||this.viz.controller;e.clearCanvas&&i.clear();var f=r.getNode(s);if(!f)return;var l=!!f.visited;r.eachNode(function(n){var r=n.getData("alpha");n.eachAdjacency(function(r){var s=r.nodeTo;if(!!s.visited===l&&n.drawn&&s.drawn){!t&&e.onBeforePlotLine(r);o.plotLine(r,i,t);!t&&e.onAfterPlotLine(r)}});if(n.drawn){!t&&e.onBeforePlotNode(n);o.plotNode(n,i,t);!t&&e.onAfterPlotNode(n)}if(!o.labelsHidden&&e.withLabels){if(n.drawn&&r>=.95){o.labels.plotLabel(i,n,e)}else{o.labels.hideLabel(n,false)}}n.visited=!l})},plotTree:function(e,t,n){var r=this,i=this.viz,s=i.canvas,o=this.config,u=s.getCtx();var a=e.getData("alpha");e.eachSubnode(function(i){if(t.plotSubtree(e,i)&&i.exist&&i.drawn){var o=e.getAdjacency(i.id);!n&&t.onBeforePlotLine(o);r.plotLine(o,s,n);!n&&t.onAfterPlotLine(o);r.plotTree(i,t,n)}});if(e.drawn){!n&&t.onBeforePlotNode(e);this.plotNode(e,s,n);!n&&t.onAfterPlotNode(e);if(!t.hideLabels&&t.withLabels&&a>=.95)this.labels.plotLabel(s,e,t);else this.labels.hideLabel(e,false)}else{this.labels.hideLabel(e,true)}},plotNode:function(e,t,n){var r=e.getData("type"),i=this.node.CanvasStyles;if(r!="none"){var s=e.getData("lineWidth"),o=e.getData("color"),u=e.getData("alpha"),a=t.getCtx();a.save();a.lineWidth=s;a.fillStyle=a.strokeStyle=o;a.globalAlpha=u;for(var f in i){a[f]=e.getCanvasStyle(f)}this.nodeTypes[r].render.call(this,e,t,n);a.restore()}},plotLine:function(e,t,n){var r=e.getData("type"),i=this.edge.CanvasStyles;if(r!="none"){var s=e.getData("lineWidth"),o=e.getData("color"),u=t.getCtx(),a=e.nodeFrom,f=e.nodeTo;u.save();u.lineWidth=s;u.fillStyle=u.strokeStyle=o;u.globalAlpha=Math.min(a.getData("alpha"),f.getData("alpha"),e.getData("alpha"));for(var l in i){u[l]=e.getCanvasStyle(l)}this.edgeTypes[r].render.call(this,e,t,n);u.restore()}}};d.Plot3D=e.merge(d.Plot,{Interpolator:{linear:function(e,t,n){var r=e.startPos.getc(true);var i=e.endPos.getc(true);e.pos.setc(this.compute(r.x,i.x,n),this.compute(r.y,i.y,n),this.compute(r.z,i.z,n))}},plotNode:function(e,t){if(e.getData("type")=="none")return;this.plotElement(e,t,{getAlpha:function(){return e.getData("alpha")}})},plotLine:function(e,t){if(e.getData("type")=="none")return;this.plotElement(e,t,{getAlpha:function(){return Math.min(e.nodeFrom.getData("alpha"),e.nodeTo.getData("alpha"),e.getData("alpha"))}})},plotElement:function(t,n,r){var i=n.getCtx(),s=new Matrix4,o=n.config.Scene.Lighting,u=n.canvases[0],a=u.program,f=u.camera;if(!t.geometry){t.geometry=new(O3D[t.getData("type")])}t.geometry.update(t);if(!t.webGLVertexBuffer){var l=[],c=[],h=[],p=0,d=t.geometry;for(var v=0,m=d.vertices,g=d.faces,y=g.length;v<y;v++){var b=g[v],w=m[b.a],E=m[b.b],S=m[b.c],x=b.d?m[b.d]:false,T=b.normal;l.push(w.x,w.y,w.z);l.push(E.x,E.y,E.z);l.push(S.x,S.y,S.z);if(x)l.push(x.x,x.y,x.z);h.push(T.x,T.y,T.z);h.push(T.x,T.y,T.z);h.push(T.x,T.y,T.z);if(x)h.push(T.x,T.y,T.z);c.push(p,p+1,p+2);if(x){c.push(p,p+2,p+3);p+=4}else{p+=3}}t.webGLVertexBuffer=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,t.webGLVertexBuffer);i.bufferData(i.ARRAY_BUFFER,new Float32Array(l),i.STATIC_DRAW);t.webGLFaceBuffer=i.createBuffer();i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.webGLFaceBuffer);i.bufferData(i.ELEMENT_ARRAY_BUFFER,new Uint16Array(c),i.STATIC_DRAW);t.webGLFaceCount=c.length;t.webGLNormalBuffer=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,t.webGLNormalBuffer);i.bufferData(i.ARRAY_BUFFER,new Float32Array(h),i.STATIC_DRAW)}s.multiply(f.matrix,t.geometry.matrix);i.uniformMatrix4fv(a.viewMatrix,false,s.flatten());i.uniformMatrix4fv(a.projectionMatrix,false,f.projectionMatrix.flatten());var N=Matrix4.makeInvert(s);N.$transpose();i.uniformMatrix4fv(a.normalMatrix,false,N.flatten());var C=e.hexToRgb(t.getData("color"));C.push(r.getAlpha());i.uniform4f(a.color,C[0]/255,C[1]/255,C[2]/255,C[3]);i.uniform1i(a.enableLighting,o.enable);if(o.enable){if(o.ambient){var k=o.ambient;i.uniform3f(a.ambientColor,k[0],k[1],k[2])}if(o.directional){var L=o.directional,C=L.color,A=L.direction,O=(new Vector3(A.x,A.y,A.z)).normalize().$scale(-1);i.uniform3f(a.lightingDirection,O.x,O.y,O.z);i.uniform3f(a.directionalColor,C[0],C[1],C[2])}}i.bindBuffer(i.ARRAY_BUFFER,t.webGLVertexBuffer);i.vertexAttribPointer(a.position,3,i.FLOAT,false,0,0);i.bindBuffer(i.ARRAY_BUFFER,t.webGLNormalBuffer);i.vertexAttribPointer(a.normal,3,i.FLOAT,false,0,0);i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t.webGLFaceBuffer);i.drawElements(i.TRIANGLES,t.webGLFaceCount,i.UNSIGNED_SHORT,0)}});d.Label={};d.Label.Native=new t({initialize:function(e){this.viz=e},plotLabel:function(e,t,n){var r=e.getCtx();var i=t.pos.getc(true);r.font=t.getLabelData("style")+" "+t.getLabelData("size")+"px "+t.getLabelData("family");r.textAlign=t.getLabelData("textAlign");r.fillStyle=r.strokeStyle=t.getLabelData("color");r.textBaseline=t.getLabelData("textBaseline");this.renderLabel(e,t,n)},renderLabel:function(e,t,n){var r=e.getCtx();var i=t.pos.getc(true);r.fillText(t.name,i.x,i.y+t.getData("height")/2)},hideLabel:e.empty,hideLabels:e.empty});d.Label.DOM=new t({labelsHidden:false,labelContainer:false,labels:{},getLabelContainer:function(){return this.labelContainer?this.labelContainer:this.labelContainer=document.getElementById(this.viz.config.labelContainer)},getLabel:function(e){return e in this.labels&&this.labels[e]!=null?this.labels[e]:this.labels[e]=document.getElementById(e)},hideLabels:function(e){var t=this.getLabelContainer();if(e)t.style.display="none";else t.style.display="";this.labelsHidden=e},clearLabels:function(e){for(var t in this.labels){if(e||!this.viz.graph.hasNode(t)){this.disposeLabel(t);delete this.labels[t]}}},disposeLabel:function(e){var t=this.getLabel(e);if(t&&t.parentNode){t.parentNode.removeChild(t)}},hideLabel:function(t,n){t=e.splat(t);var r=n?"":"none",i,s=this;e.each(t,function(e){var t=s.getLabel(e.id);if(t){t.style.display=r}})},fitsInCanvas:function(e,t){var n=t.getSize();if(e.x>=n.width||e.x<0||e.y>=n.height||e.y<0)return false;return true}});d.Label.HTML=new t({Implements:d.Label.DOM,plotLabel:function(e,t,n){var r=t.id,i=this.getLabel(r);if(!i&&!(i=document.getElementById(r))){i=document.createElement("div");var s=this.getLabelContainer();i.id=r;i.className="node";i.style.position="absolute";n.onCreateLabel(i,t);s.appendChild(i);this.labels[t.id]=i}this.placeLabel(i,t,n)}});d.Label.SVG=new t({Implements:d.Label.DOM,plotLabel:function(e,t,n){var r=t.id,i=this.getLabel(r);if(!i&&!(i=document.getElementById(r))){var s="http://www.w3.org/2000/svg";i=document.createElementNS(s,"svg:text");var o=document.createElementNS(s,"svg:tspan");i.appendChild(o);var u=this.getLabelContainer();i.setAttribute("id",r);i.setAttribute("class","node");u.appendChild(i);n.onCreateLabel(i,t);this.labels[t.id]=i}this.placeLabel(i,t,n)}});d.Geom=new t({initialize:function(e){this.viz=e;this.config=e.config;this.node=e.config.Node;this.edge=e.config.Edge},translate:function(t,n){n=e.splat(n);this.viz.graph.eachNode(function(r){e.each(n,function(e){r.getPos(e).$add(t)})})},setRightLevelToShow:function(t,n,r){var i=this.getRightLevelToShow(t,n),s=this.viz.labels,o=e.merge({execShow:true,execHide:true,onHide:e.empty,onShow:e.empty},r||{});t.eachLevel(0,this.config.levelsToShow,function(e){var n=e._depth-t._depth;if(n>i){o.onHide(e);if(o.execHide){e.drawn=false;e.exist=false;s.hideLabel(e,false)}}else{o.onShow(e);if(o.execShow){e.exist=true}}});t.drawn=true},getRightLevelToShow:function(e,t){var n=this.config;var r=n.levelsToShow;var i=n.constrained;if(!i)return r;while(!this.treeFitsInCanvas(e,t,r)&&r>1){r--}return r}});var y={construct:function(t){var n=e.type(t)=="array";var r=new d(this.graphOptions,this.config.Node,this.config.Edge,this.config.Label);if(!n)(function(e,t){e.addNode(t);if(t.children){for(var n=0,r=t.children;n<r.length;n++){e.addAdjacence(t,r[n]);arguments.callee(e,r[n])}}})(r,t);else(function(t,n){var r=function(e){for(var r=0,i=n.length;r<i;r++){if(n[r].id==e){return n[r]}}var s={id:e,name:e};return t.addNode(s)};for(var i=0,s=n.length;i<s;i++){t.addNode(n[i]);var o=n[i].adjacencies;if(o){for(var u=0,a=o.length;u<a;u++){var f=o[u],l={};if(typeof o[u]!="string"){l=e.merge(f.data,{});f=f.nodeTo}t.addAdjacence(n[i],r(f),l)}}}})(r,t);return r},loadJSON:function(t,n){this.json=t;if(this.labels&&this.labels.clearLabels){this.labels.clearLabels(true)}this.graph=this.construct(t);if(e.type(t)!="array"){this.root=t.id}else{this.root=t[n?n:0].id}},toJSON:function(e){e=e||"tree";if(e=="tree"){var t={};var n=this.graph.getNode(this.root);var t=function i(e){var t={};t.id=e.id;t.name=e.name;t.data=e.data;var n=[];e.eachSubnode(function(e){n.push(i(e))});t.children=n;return t}(n);return t}else{var t=[];var r=!!this.graph.getNode(this.root).visited;this.graph.eachNode(function(e){var n={};n.id=e.id;n.name=e.name;n.data=e.data;var i=[];e.eachAdjacency(function(e){var t=e.nodeTo;if(!!t.visited===r){var n={};n.nodeTo=t.id;n.data=e.data;i.push(n)}});n.adjacencies=i;t.push(n);e.visited=!r});return t}}};var b=$jit.Layouts={};var w={label:null,compute:function(t,n,r){this.initializeLabel(r);var i=this.label,s=i.style;t.eachNode(function(t){var n=t.getData("autoWidth"),r=t.getData("autoHeight");if(n||r){delete t.data.$width;delete t.data.$height;delete t.data.$dim;var o=t.getData("width"),u=t.getData("height");s.width=n?"auto":o+"px";s.height=r?"auto":u+"px";i.innerHTML=t.name;var a=i.offsetWidth,f=i.offsetHeight;var l=t.getData("type");if(e.indexOf(["circle","square","triangle","star"],l)===-1){t.setData("width",a);t.setData("height",f)}else{var c=a>f?a:f;t.setData("width",c);t.setData("height",c);t.setData("dim",c)}}})},initializeLabel:function(e){if(!this.label){this.label=document.createElement("div");document.body.appendChild(this.label)}this.setLabelStyles(e)},setLabelStyles:function(t){e.extend(this.label.style,{visibility:"hidden",position:"absolute",width:"auto",height:"auto"});this.label.className="jit-autoadjust-label"}};b.Tree=function(){function r(e,t,n,r,i){var s=t.Node;var o=t.multitree;if(s.overridable){var u=-1,a=-1;e.eachNode(function(e){if(e._depth==n&&(!o||"$orn"in e.data&&e.data.$orn==r)){var t=e.getData("width",i);var s=e.getData("height",i);u=u<t?t:u;a=a<s?s:a}});return{width:u<0?s.width:u,height:a<0?s.height:a}}else{return s}}function i(e,t,n,r){var i=r=="left"||r=="right"?"y":"x";e.getPos(t)[i]+=n}function s(t,r){var i=[];e.each(t,function(e){e=n.call(e);e[0]+=r;e[1]+=r;i.push(e)});return i}function o(e,t){if(e.length==0)return t;if(t.length==0)return e;var n=e.shift(),r=t.shift();return[[n[0],r[1]]].concat(o(e,t))}function u(e,t){t=t||[];if(e.length==0)return t;var n=e.pop();return u(e,o(n,t))}function a(e,t,n,r,i){if(e.length<=i||t.length<=i)return 0;var s=e[i][1],o=t[i][0];return Math.max(a(e,t,n,r,++i)+n,s-o+r)}function f(e,t,n){function r(e,i,u){if(i.length<=u)return[];var f=i[u],l=a(e,f,t,n,0);return[l].concat(r(o(e,s(f,l)),i,++u))}return r([],e,0)}function l(e,t,r){function i(e,n,u){if(n.length<=u)return[];var f=n[u],l=-a(f,e,t,r,0);return[l].concat(i(o(s(f,l),e),n,++u))}e=n.call(e);var u=i([],e.reverse(),0);return u.reverse()}function c(e,t,n,r){var i=f(e,t,n),s=l(e,t,n);if(r=="left")s=i;else if(r=="right")i=s;for(var o=0,u=[];o<i.length;o++){u[o]=(i[o]+s[o])/2}return u}function h(e,t,n,o,a){function S(t,l,h){var p=t.getData(g,n);var m=l||t.getData(y,n);var x=[],T=[],N=false;var C=m+o.levelDistance;t.eachSubnode(function(t){if(t.exist&&(!f||"$orn"in t.data&&t.data.$orn==a)){if(!N)N=r(e,o,t._depth,a,n);var i=S(t,N[y],h+C);x.push(i.tree);T.push(i.extent)}});var k=c(T,w,b,E);for(var L=0,A=[],O=[];L<x.length;L++){i(x[L],n,k[L],a);O.push(s(T[L],k[L]))}var M=[[-p/2,p/2]].concat(u(O));t.getPos(n)[d]=0;if(a=="top"||a=="left"){t.getPos(n)[v]=h}else{t.getPos(n)[v]=-h}return{tree:t,extent:M}}var f=o.multitree;var l=["x","y"],h=["width","height"];var p=+(a=="left"||a=="right");var d=l[p],v=l[1-p];var m=o.Node;var g=h[p],y=h[1-p];var b=o.siblingOffset;var w=o.subtreeOffset;var E=o.align;S(t,false,0)}var n=Array.prototype.slice;return new t({compute:function(t,n){var r=t||"start";var i=this.graph.getNode(this.root);e.extend(i,{drawn:true,exist:true,selected:true});w.compute(this.graph,r,this.config);if(!!n||!("_depth"in i)){this.graph.computeLevels(this.root,0,"ignore")}this.computePositions(i,r)},computePositions:function(t,n){var r=this.config;var i=r.multitree;var s=r.align;var o=s!=="center"&&r.indent;var u=r.orientation;var a=i?["top","right","bottom","left"]:[u];var f=this;e.each(a,function(e){h(f.graph,t,n,f.config,e,n);var r=["x","y"][+(e=="left"||e=="right")];(function u(t){t.eachSubnode(function(a){if(a.exist&&(!i||"$orn"in a.data&&a.data.$orn==e)){a.getPos(n)[r]+=t.getPos(n)[r];if(o){a.getPos(n)[r]+=s=="left"?o:-o}u(a)}})})(t)})}})}();$jit.ST=function(){function r(e){e=e||this.clickedNode;if(!this.config.constrained){return[]}var t=this.geom;var r=this.graph;var i=this.canvas;var s=e._depth,o=[];r.eachNode(function(t){if(t.exist&&!t.selected){if(t.isDescendantOf(e.id)){if(t._depth<=s)o.push(t)}else{o.push(t)}}});var u=t.getRightLevelToShow(e,i);e.eachLevel(u,u,function(e){if(e.exist&&!e.selected)o.push(e)});for(var a=0;a<n.length;a++){var f=this.graph.getNode(n[a]);if(!f.isDescendantOf(e.id)){o.push(f)}}return o}function s(e){var t=[],n=this.config;e=e||this.clickedNode;this.clickedNode.eachLevel(0,n.levelsToShow,function(e){if(n.multitree&&!("$orn"in e.data)&&e.anySubnode(function(e){return e.exist&&!e.drawn})){t.push(e)}else if(e.drawn&&!e.anySubnode("drawn")){t.push(e)}});return t}var n=[];return new t({Implements:[y,a,b.Tree],initialize:function(t){var n=$jit.ST;var r={levelsToShow:2,levelDistance:30,constrained:true,Node:{type:"rectangle"},duration:700,offsetX:0,offsetY:0};this.controller=this.config=e.merge(i("Canvas","Fx","Tree","Node","Edge","Controller","Tips","NodeStyles","Events","Navigation","Label"),r,t);var s=this.config;if(s.useCanvas){this.canvas=s.useCanvas;this.config.labelContainer=this.canvas.id+"-label"}else{if(s.background){s.background=e.merge({type:"Circles"},s.background)}this.canvas=new f(this,s);this.config.labelContainer=(typeof s.injectInto=="string"?s.injectInto:s.injectInto.id)+"-label"}this.graphOptions={klass:h};this.graph=new d(this.graphOptions,this.config.Node,this.config.Edge);this.labels=new n.Label[s.Label.type](this);this.fx=new n.Plot(this,n);this.op=new n.Op(this);this.group=new n.Group(this);this.geom=new n.Geom(this);this.clickedNode=null;this.initializeExtras()},plot:function(){this.fx.plot(this.controller)},switchPosition:function(e,t,n){var r=this.geom,i=this.fx,s=this;if(!i.busy){i.busy=true;this.contract({onComplete:function(){r.switchOrientation(e);s.compute("end",false);i.busy=false;if(t=="animate"){s.onClick(s.clickedNode.id,n)}else if(t=="replot"){s.select(s.clickedNode.id,n)}}},e)}},switchAlignment:function(e,t,n){this.config.align=e;if(t=="animate"){this.select(this.clickedNode.id,n)}else if(t=="replot"){this.onClick(this.clickedNode.id,n)}},addNodeInPath:function(e){n.push(e);this.select(this.clickedNode&&this.clickedNode.id||this.root)},clearNodesInPath:function(e){n.length=0;this.select(this.clickedNode&&this.clickedNode.id||this.root)},refresh:function(){this.reposition();this.select(this.clickedNode&&this.clickedNode.id||this.root)},reposition:function(){this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(this.clickedNode,this.canvas);this.graph.eachNode(function(e){if(e.exist)e.drawn=true});this.compute("end")},requestNodes:function(t,n){var r=e.merge(this.controller,n),i=this.config.levelsToShow;if(r.request){var s=[],o=t._depth;t.eachLevel(0,i,function(e){if(e.drawn&&!e.anySubnode()){s.push(e);e._level=i-(e._depth-o)}});this.group.requestNodes(s,r)}else r.onComplete()},contract:function(t,n){var i=this.config.orientation;var s=this.geom,o=this.group;if(n)s.switchOrientation(n);var u=r.call(this);if(n)s.switchOrientation(i);o.contract(u,e.merge(this.controller,t))},move:function(t,n){this.compute("end",false);var r=n.Move,i={x:r.offsetX,y:r.offsetY};if(r.enable){this.geom.translate(t.endPos.add(i).$scale(-1),"end")}this.fx.animate(e.merge(this.controller,{modes:["linear"]},n))},expand:function(t,n){var r=s.call(this,t);this.group.expand(r,e.merge(this.controller,n))},selectPath:function(t){function i(t){if(t==null||t.selected)return;t.selected=true;e.each(r.group.getSiblings([t])[t.id],function(e){e.exist=true;e.drawn=true});var n=t.getParents();n=n.length>0?n[0]:null;i(n)}var r=this;this.graph.eachNode(function(e){e.selected=false});for(var s=0,o=[t.id].concat(n);s<o.length;s++){i(this.graph.getNode(o[s]))}},setRoot:function(e,t,n){function u(){if(this.config.multitree&&o.data.$orn){var t=o.data.$orn;var u={left:"right",right:"left",top:"bottom",bottom:"top"}[t];s.data.$orn=u;(function a(t){t.eachSubnode(function(t){if(t.id!=e){t.data.$orn=u;a(t)}})})(s);delete o.data.$orn}this.root=e;this.clickedNode=o;this.graph.computeLevels(this.root,0,"ignore");this.geom.setRightLevelToShow(o,i,{execHide:false,onShow:function(e){if(!e.drawn){e.drawn=true;e.setData("alpha",1,"end");e.setData("alpha",0);e.pos.setc(o.pos.x,o.pos.y)}}});this.compute("end");this.busy=true;this.fx.animate({modes:["linear","node-property:alpha"],onComplete:function(){r.busy=false;r.onClick(e,{onComplete:function(){n&&n.onComplete()}})}})}if(this.busy)return;this.busy=true;var r=this,i=this.canvas;var s=this.graph.getNode(this.root);var o=this.graph.getNode(e);delete s.data.$orns;if(t=="animate"){u.call(this);r.selectPath(o)}else if(t=="replot"){u.call(this);this.select(this.root)}},addSubtree:function(t,n,r){if(n=="replot"){this.op.sum(t,e.extend({type:"replot"},r||{}))}else if(n=="animate"){this.op.sum(t,e.extend({type:"fade:seq"},r||{}))}},removeSubtree:function(t,n,r,i){var s=this.graph.getNode(t),o=[];s.eachLevel(+!n,false,function(e){o.push(e.id)});if(r=="replot"){this.op.removeNode(o,e.extend({type:"replot"},i||{}))}else if(r=="animate"){this.op.removeNode(o,e.extend({type:"fade:seq"},i||{}))}},select:function(t,n){var i=this.group,o=this.geom;var u=this.graph.getNode(t),a=this.canvas;var f=this.graph.getNode(this.root);var l=e.merge(this.controller,n);var c=this;l.onBeforeCompute(u);this.selectPath(u);this.clickedNode=u;this.requestNodes(u,{onComplete:function(){i.hide(i.prepare(r.call(c)),l);o.setRightLevelToShow(u,a);c.compute("current");c.graph.eachNode(function(e){var t=e.pos.getc(true);e.startPos.setc(t.x,t.y);e.endPos.setc(t.x,t.y);e.visited=false});var e={x:l.offsetX,y:l.offsetY};c.geom.translate(u.endPos.add(e).$scale(-1),["start","current","end"]);i.show(s.call(c));c.plot();l.onAfterCompute(c.clickedNode);l.onComplete()}})},onClick:function(t,n){var r=this.canvas,i=this,s=this.geom,o=this.config;var u={Move:{enable:true,offsetX:o.offsetX||0,offsetY:o.offsetY||0},setRightLevelToShowConfig:false,onBeforeRequest:e.empty,onBeforeContract:e.empty,onBeforeMove:e.empty,onBeforeExpand:e.empty};var a=e.merge(this.controller,u,n);if(!this.busy){this.busy=true;var f=this.graph.getNode(t);this.selectPath(f,this.clickedNode);this.clickedNode=f;a.onBeforeCompute(f);a.onBeforeRequest(f);this.requestNodes(f,{onComplete:function(){a.onBeforeContract(f);i.contract({onComplete:function(){s.setRightLevelToShow(f,r,a.setRightLevelToShowConfig);a.onBeforeMove(f);i.move(f,{Move:a.Move,onComplete:function(){a.onBeforeExpand(f);i.expand(f,{onComplete:function(){i.busy=false;a.onAfterCompute(t);a.onComplete()}})}})}})}})}}})}();$jit.ST.$extend=true;$jit.ST.Op=new t({Implements:d.Op});$jit.ST.Group=new t({initialize:function(e){this.viz=e;this.canvas=e.canvas;this.config=e.config;this.animation=new r;this.nodes=null},requestNodes:function(e,t){var n=0,r=e.length,i={};var s=function(){t.onComplete()};var o=this.viz;if(r==0)s();for(var u=0;u<r;u++){i[e[u].id]=e[u];t.request(e[u].id,e[u]._level,{onComplete:function(e,t){if(t&&t.children){t.id=e;o.op.sum(t,{type:"nothing"})}if(++n==r){o.graph.computeLevels(o.root,0);s()}}})}},contract:function(t,n){var r=this.viz;var i=this;t=this.prepare(t);this.animation.setOptions(e.merge(n,{$animating:false,compute:function(e){if(e==1)e=.99;i.plotStep(1-e,n,this.$animating);this.$animating="contract"},complete:function(){i.hide(t,n)}})).start()},hide:function(t,n){var r=this.viz;for(var i=0;i<t.length;i++){if(true||!n||!n.request){t[i].eachLevel(1,false,function(t){if(t.exist){e.extend(t,{drawn:false,exist:false})}})}else{var s=[];t[i].eachLevel(1,false,function(e){s.push(e.id)});r.op.removeNode(s,{type:"nothing"});r.labels.clearLabels()}}n.onComplete()},expand:function(t,n){var r=this;this.show(t);this.animation.setOptions(e.merge(n,{$animating:false,compute:function(e){r.plotStep(e,n,this.$animating);this.$animating="expand"},complete:function(){r.plotStep(undefined,n,false);n.onComplete()}})).start()},show:function(t){var n=this.config;this.prepare(t);e.each(t,function(e){if(n.multitree&&!("$orn"in e.data)){delete e.data.$orns;var t=" ";e.eachSubnode(function(e){if("$orn"in e.data&&t.indexOf(e.data.$orn)<0&&e.exist&&!e.drawn){t+=e.data.$orn+" "}});e.data.$orns=t}e.eachLevel(0,n.levelsToShow,function(e){if(e.exist)e.drawn=true})})},prepare:function(e){this.nodes=this.getNodesWithChildren(e);return this.nodes},getNodesWithChildren:function(e){var t=[],n=this.config,r=this.viz.root;e.sort(function(e,t){return(e._depth<=t._depth)-(e._depth>=t._depth)});for(var i=0;i<e.length;i++){if(e[i].anySubnode("exist")){for(var s=i+1,o=false;!o&&s<e.length;s++){if(!n.multitree||"$orn"in e[s].data){o=o||e[i].isDescendantOf(e[s].id)}}if(!o)t.push(e[i])}}return t},plotStep:function(t,n,r){var i=this.viz,s=this.config,o=i.canvas,u=o.getCtx(),a=this.nodes;var f,l;var c={};for(f=0;f<a.length;f++){l=a[f];c[l.id]=[];var h=s.multitree&&!("$orn"in l.data);var p=h&&l.data.$orns;l.eachSubgraph(function(e){if(h&&p&&p.indexOf(e.data.$orn)>0&&e.drawn){e.drawn=false;c[l.id].push(e)}else if((!h||!p)&&e.drawn){e.drawn=false;c[l.id].push(e)}});l.drawn=true}if(a.length>0)i.fx.plot();for(f in c){e.each(c[f],function(e){e.drawn=true})}for(f=0;f<a.length;f++){l=a[f];u.save();i.fx.plotSubtree(l,n,t,r);u.restore()}},getSiblings:function(t){var n={};e.each(t,function(e){var t=e.getParents();if(t.length==0){n[e.id]=[e]}else{var r=[];t[0].eachSubnode(function(e){r.push(e)});n[e.id]=r}});return n}});$jit.ST.Geom=new t({Implements:d.Geom,switchOrientation:function(e){this.config.orientation=e},dispatch:function(){var e=Array.prototype.slice.call(arguments);var t=e.shift(),n=e.length;var r=function(e){return typeof e=="function"?e():e};if(n==2){return t=="top"||t=="bottom"?r(e[0]):r(e[1])}else if(n==4){switch(t){case"top":return r(e[0]);case"right":return r(e[1]);case"bottom":return r(e[2]);case"left":return r(e[3])}}return undefined},getSize:function(e,t){var n=e.data,r=this.config;var i=r.siblingOffset;var s=r.multitree&&"$orn"in n&&n.$orn||r.orientation;var o=e.getData("width")+i;var u=e.getData("height")+i;if(!t)return this.dispatch(s,u,o);else return this.dispatch(s,o,u)},getTreeBaseSize:function(e,t,n){var r=this.getSize(e,true),i=0,s=this;if(n(t,e))return r;if(t===0)return 0;e.eachSubnode(function(e){i+=s.getTreeBaseSize(e,t-1,n)});return(r>i?r:i)+this.config.subtreeOffset},getEdge:function(e,t,n){var r=function(t,n){return function(){return e.pos.add(new h(t,n))}};var i=this.node;var s=e.getData("width");var o=e.getData("height");if(t=="begin"){if(i.align=="center"){return this.dispatch(n,r(0,o/2),r(-s/2,0),r(0,-o/2),r(s/2,0))}else if(i.align=="left"){return this.dispatch(n,r(0,o),r(0,0),r(0,0),r(s,0))}else if(i.align=="right"){return this.dispatch(n,r(0,0),r(-s,0),r(0,-o),r(0,0))}else throw"align: not implemented"}else if(t=="end"){if(i.align=="center"){return this.dispatch(n,r(0,-o/2),r(s/2,0),r(0,o/2),r(-s/2,0))}else if(i.align=="left"){return this.dispatch(n,r(0,0),r(s,0),r(0,o),r(0,0))}else if(i.align=="right"){return this.dispatch(n,r(0,-o),r(0,0),r(0,0),r(-s,0))}else throw"align: not implemented"}},getScaledTreePosition:function(e,t){var n=this.node;var r=e.getData("width");var i=e.getData("height");var s=this.config.multitree&&"$orn"in e.data&&e.data.$orn||this.config.orientation;var o=function(n,r){return function(){return e.pos.add(new h(n,r)).$scale(1-t)}};if(n.align=="left"){return this.dispatch(s,o(0,i),o(0,0),o(0,0),o(r,0))}else if(n.align=="center"){return this.dispatch(s,o(0,i/2),o(-r/2,0),o(0,-i/2),o(r/2,0))}else if(n.align=="right"){return this.dispatch(s,o(0,0),o(-r,0),o(0,-i),o(0,0))}else throw"align: not implemented"},treeFitsInCanvas:function(e,t,n){var r=t.getSize();var i=this.config.multitree&&"$orn"in e.data&&e.data.$orn||this.config.orientation;var s=this.dispatch(i,r.width,r.height);var o=this.getTreeBaseSize(e,n,function(e,t){return e===0||!t.anySubnode()});return o<s}});$jit.ST.Plot=new t({Implements:d.Plot,plotSubtree:function(t,n,r,i){var s=this.viz,o=s.canvas,u=s.config;r=Math.min(Math.max(.001,r),1);if(r>=0){t.drawn=false;var a=o.getCtx();var f=s.geom.getScaledTreePosition(t,r);a.translate(f.x,f.y);a.scale(r,r)}this.plotTree(t,e.merge(n,{withLabels:true,hideLabels:!!r,plotSubtree:function(e,n){var r=u.multitree&&!("$orn"in t.data);var i=r&&t.getData("orns");return!r||i.indexOf(t.getData("orn"))>-1}}),i);if(r>=0)t.drawn=true},getAlignedPos:function(e,t,n){var r=this.node;var i,s;if(r.align=="center"){i={x:e.x-t/2,y:e.y-n/2}}else if(r.align=="left"){s=this.config.orientation;if(s=="bottom"||s=="top"){i={x:e.x-t/2,y:e.y}}else{i={x:e.x,y:e.y-n/2}}}else if(r.align=="right"){s=this.config.orientation;if(s=="bottom"||s=="top"){i={x:e.x-t/2,y:e.y-n}}else{i={x:e.x-t,y:e.y-n/2}}}else throw"align: not implemented";return i},getOrientation:function(e){var t=this.config;var n=t.orientation;if(t.multitree){var r=e.nodeFrom;var i=e.nodeTo;n="$orn"in r.data&&r.data.$orn||"$orn"in i.data&&i.data.$orn}return n}});$jit.ST.Label={};$jit.ST.Label.Native=new t({Implements:d.Label.Native,renderLabel:function(e,t,n){var r=e.getCtx(),i=t.pos.getc(true),s=t.getData("width"),o=t.getData("height"),u=this.viz.fx.getAlignedPos(i,s,o);r.fillText(t.name,u.x+s/2,u.y+o/2)}});$jit.ST.Label.DOM=new t({Implements:d.Label.DOM,placeLabel:function(e,t,n){var r=t.pos.getc(true),i=this.viz.config,s=i.Node,o=this.viz.canvas,u=t.getData("width"),a=t.getData("height"),f=o.getSize(),l,c;var h=o.translateOffsetX,p=o.translateOffsetY,d=o.scaleOffsetX,v=o.scaleOffsetY,m=r.x*d+h,g=r.y*v+p;if(s.align=="center"){l={x:Math.round(m-u/2+f.width/2),y:Math.round(g-a/2+f.height/2)}}else if(s.align=="left"){c=i.orientation;if(c=="bottom"||c=="top"){l={x:Math.round(m-u/2+f.width/2),y:Math.round(g+f.height/2)}}else{l={x:Math.round(m+f.width/2),y:Math.round(g-a/2+f.height/2)}}}else if(s.align=="right"){c=i.orientation;if(c=="bottom"||c=="top"){l={x:Math.round(m-u/2+f.width/2),y:Math.round(g-a+f.height/2)}}else{l={x:Math.round(m-u+f.width/2),y:Math.round(g-a/2+f.height/2)}}}else throw"align: not implemented";var y=e.style;y.left=l.x+"px";y.top=l.y+"px";y.display=this.fitsInCanvas(l,o)?"":"none";n.onPlaceLabel(e,t)}});$jit.ST.Label.SVG=new t({Implements:[$jit.ST.Label.DOM,d.Label.SVG],initialize:function(e){this.viz=e}});$jit.ST.Label.HTML=new t({Implements:[$jit.ST.Label.DOM,d.Label.HTML],initialize:function(e){this.viz=e}});$jit.ST.Plot.NodeTypes=new t({none:{render:e.empty,contains:e.lambda(false)},circle:{render:function(e,t){var n=e.getData("dim"),r=this.getAlignedPos(e.pos.getc(true),n,n),i=n/2;this.nodeHelper.circle.render("fill",{x:r.x+i,y:r.y+i},i,t)},contains:function(e,t){var n=e.getData("dim"),r=this.getAlignedPos(e.pos.getc(true),n,n),i=n/2;this.nodeHelper.circle.contains({x:r.x+i,y:r.y+i},t,i)}},square:{render:function(e,t){var n=e.getData("dim"),r=n/2,i=this.getAlignedPos(e.pos.getc(true),n,n);this.nodeHelper.square.render("fill",{x:i.x+r,y:i.y+r},r,t)},contains:function(e,t){var n=e.getData("dim"),r=this.getAlignedPos(e.pos.getc(true),n,n),i=n/2;this.nodeHelper.square.contains({x:r.x+i,y:r.y+i},t,i)}},ellipse:{render:function(e,t){var n=e.getData("width"),r=e.getData("height"),i=this.getAlignedPos(e.pos.getc(true),n,r);this.nodeHelper.ellipse.render("fill",{x:i.x+n/2,y:i.y+r/2},n,r,t)},contains:function(e,t){var n=e.getData("width"),r=e.getData("height"),i=this.getAlignedPos(e.pos.getc(true),n,r);this.nodeHelper.ellipse.contains({x:i.x+n/2,y:i.y+r/2},t,n,r)}},rectangle:{render:function(e,t){var n=e.getData("width"),r=e.getData("height"),i=this.getAlignedPos(e.pos.getc(true),n,r);this.nodeHelper.rectangle.render("fill",{x:i.x+n/2,y:i.y+r/2},n,r,t)},contains:function(e,t){var n=e.getData("width"),r=e.getData("height"),i=this.getAlignedPos(e.pos.getc(true),n,r);this.nodeHelper.rectangle.contains({x:i.x+n/2,y:i.y+r/2},t,n,r)}}});$jit.ST.Plot.EdgeTypes=new t({none:e.empty,line:{render:function(e,t){var n=this.getOrientation(e),r=e.nodeFrom,i=e.nodeTo,s=r._depth<i._depth,o=this.viz.geom.getEdge(s?r:i,"begin",n),u=this.viz.geom.getEdge(s?i:r,"end",n);this.edgeHelper.line.render(o,u,t)},contains:function(e,t){var n=this.getOrientation(e),r=e.nodeFrom,i=e.nodeTo,s=r._depth<i._depth,o=this.viz.geom.getEdge(s?r:i,"begin",n),u=this.viz.geom.getEdge(s?i:r,"end",n);return this.edgeHelper.line.contains(o,u,t,this.edge.epsilon)}},arrow:{render:function(e,t){var n=this.getOrientation(e),r=e.nodeFrom,i=e.nodeTo,s=e.getData("dim"),o=this.viz.geom.getEdge(r,"begin",n),u=this.viz.geom.getEdge(i,"end",n),a=e.data.$direction,f=a&&a.length>1&&a[0]!=r.id;this.edgeHelper.arrow.render(o,u,s,f,t)},contains:function(e,t){var n=this.getOrientation(e),r=e.nodeFrom,i=e.nodeTo,s=r._depth<i._depth,o=this.viz.geom.getEdge(s?r:i,"begin",n),u=this.viz.geom.getEdge(s?i:r,"end",n);return this.edgeHelper.arrow.contains(o,u,t,this.edge.epsilon)}},"quadratic:begin":{render:function(e,t){var n=this.getOrientation(e);var r=e.nodeFrom,i=e.nodeTo,s=r._depth<i._depth,o=this.viz.geom.getEdge(s?r:i,"begin",n),u=this.viz.geom.getEdge(s?i:r,"end",n),a=e.getData("dim"),f=t.getCtx();f.beginPath();f.moveTo(o.x,o.y);switch(n){case"left":f.quadraticCurveTo(o.x+a,o.y,u.x,u.y);break;case"right":f.quadraticCurveTo(o.x-a,o.y,u.x,u.y);break;case"top":f.quadraticCurveTo(o.x,o.y+a,u.x,u.y);break;case"bottom":f.quadraticCurveTo(o.x,o.y-a,u.x,u.y);break}f.stroke()}},"quadratic:end":{render:function(e,t){var n=this.getOrientation(e);var r=e.nodeFrom,i=e.nodeTo,s=r._depth<i._depth,o=this.viz.geom.getEdge(s?r:i,"begin",n),u=this.viz.geom.getEdge(s?i:r,"end",n),a=e.getData("dim"),f=t.getCtx();f.beginPath();f.moveTo(o.x,o.y);switch(n){case"left":f.quadraticCurveTo(u.x-a,u.y,u.x,u.y);break;case"right":f.quadraticCurveTo(u.x+a,u.y,u.x,u.y);break;case"top":f.quadraticCurveTo(u.x,u.y-a,u.x,u.y);break;case"bottom":f.quadraticCurveTo(u.x,u.y+a,u.x,u.y);break}f.stroke()}},bezier:{render:function(e,t){var n=this.getOrientation(e),r=e.nodeFrom,i=e.nodeTo,s=r._depth<i._depth,o=this.viz.geom.getEdge(s?r:i,"begin",n),u=this.viz.geom.getEdge(s?i:r,"end",n),a=e.getData("dim"),f=t.getCtx();f.beginPath();f.moveTo(o.x,o.y);switch(n){case"left":f.bezierCurveTo(o.x+a,o.y,u.x-a,u.y,u.x,u.y);break;case"right":f.bezierCurveTo(o.x-a,o.y,u.x+a,u.y,u.x,u.y);break;case"top":f.bezierCurveTo(o.x,o.y+a,u.x,u.y-a,u.x,u.y);break;case"bottom":f.bezierCurveTo(o.x,o.y-a,u.x,u.y+a,u.x,u.y);break}f.stroke()}}})})()



/*
// Create a <div id="#connectionTree" 
var st = new $jit.ST({  
    //id of viz container element  
    injectInto: 'connectionTree',  
    orientation:'top',
    //set duration for the animation  
    duration: 200,  
    //set animation transition type  
    transition: $jit.Trans.Quart.easeInOut,  
    //set distance between node and its children  
    levelDistance: 50,  
    //enable panning  
    Navigation: {  
      enable:true,  
      panning:true
    },  
    //set node and edge styles  
    //set overridable=true for styling individual  
    //nodes or edges  
    Node: {  
        height: 35,  
        width: 200,  
        type: 'rectangle',  
        color: '#aaa',  
        overridable: true  
    },  
      
    Edge: {  
        type: 'bezier',  
        overridable: true  
    },  
      
    onBeforeCompute: function(node){  
      //  Log.write("loading " + node.name);  
    },  
      
    onAfterCompute: function(){  
      //  Log.write("done");  
    },  
      
    //This method is called on DOM label creation.  
    //Use this method to add event handlers and styles to  
    //your node.  
    onCreateLabel: function(label, node){  
        label.id = node.id;              
        label.innerHTML = node.name;  
        label.onclick = function(){  
              st.onClick(node.id); 
        };  
        //set label styles  
        var style = label.style;  
        style.width = 200 + 'px';  
        style.height = 35 + 'px';              
        style.cursor = 'pointer';  
        style.color = '#333';  
        style.fontSize = '0.8em';  
        style.textAlign= 'center';  
        style.paddingTop = '3px';  
    },  
      
    //This method is called right before plotting  
    //a node. It's useful for changing an individual node  
    //style properties before plotting it.  
    //The data properties prefixed with a dollar  
    //sign will override the global node style properties.  
    onBeforePlotNode: function(node){  
        //add some color to the nodes in the path between the  
        //root node and the selected node.  
        if (node.selected) {  
            node.data.$color = "#EB7700";  
        }  
        else {  
            delete node.data.$color;  
            //if the node belongs to the last plotted level  
            if(!node.anySubnode("exist")) {  
                //count children number  
                var count = 0;  
                node.eachSubnode(function(n) { count++; });  
                //assign a node color based on  
                //how many children it has  
                if (count > 0)
                {
					node.data.$color = '#A3BE99';
                }
                else
                {
                	node.data.$color = '#aaa';
                }
                //node.data.$color = ['#aaa', '#baa', '#caa', '#daa', '#eaa', '#faa'][count];                      
            }  
        }  
    },  
      
    //This method is called right before plotting  
    //an edge. It's useful for changing an individual edge  
    //style properties before plotting it.  
    //Edge data proprties prefixed with a dollar sign will  
    //override the Edge global style properties.  
    onBeforePlotLine: function(adj){  
        if (adj.nodeFrom.selected && adj.nodeTo.selected) {  
            adj.data.$color = "#eed";  
            adj.data.$lineWidth = 3;  
        }  
        else {  
            delete adj.data.$color;  
            delete adj.data.$lineWidth;  
        }  
    }  
});  
//load json data  
//st.loadJSON(json);
$.get('http://ands3.anu.edu.au/workareas/ben/ands/arms/src/portal/view/connectionGraph?slug=uber-container',
	function(data){
		st.loadJSON(data[0]);
		st.compute();  
		st.geom.translate(new $jit.Complex(-200, 0), "current");  
		st.onClick(st.root);


	},'json');
*/